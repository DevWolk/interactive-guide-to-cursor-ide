<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Интерактивный гайд по Cursor IDE для PHP/Laravel (Обновлено 29 Мая 2025)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc; /* bg-slate-50 */
            color: #334155; /* text-slate-700 */
        }
        .content-section {
            display: none;
        }
        .content-section.active {
            display: block;
        }
        .nav-link {
            cursor: pointer;
            padding: 0.75rem 1rem;
            border-radius: 0.375rem;
            transition: background-color 0.2s ease-in-out, color 0.2s ease-in-out;
            color: #475569; /* text-slate-600 */
            font-size: 0.9rem;
        }
        .nav-link:hover {
            background-color: #e2e8f0; /* bg-slate-200 */
            color: #1e293b; /* text-slate-800 */
        }
        .nav-link.active {
            background-color: #0ea5e9; /* bg-sky-500 */
            color: white;
            font-weight: 600;
        }
        .nav-link.active:hover {
            background-color: #0284c7; /* bg-sky-600 */
        }
        h1.main-title {
            font-size: 1.5rem; /* text-2xl */
            font-weight: 700; /* font-bold */
            color: #0369a1; /* text-sky-700 */
            margin-bottom: 1.5rem; /* mb-6 */
            text-align: center;
        }
        h2 { /* Section title */
            font-size: 1.875rem; /* text-3xl */
            font-weight: 700;
            color: #0ea5e9; /* text-sky-500 */
            margin-bottom: 1.5rem; /* Increased margin */
            padding-bottom: 0.75rem; /* Increased padding */
            border-bottom: 2px solid #e2e8f0; /* border-slate-200 */
        }
        h3 { /* Subsection title */
            font-size: 1.5rem; /* text-2xl */
            font-weight: 600;
            color: #1e293b; /* text-slate-800 */
            margin-top: 2rem; /* Increased top margin */
            margin-bottom: 1rem;
        }
        h4 { /* Sub-subsection title */
            font-size: 1.25rem; /* text-xl */
            font-weight: 600;
            color: #334155; /* text-slate-700 */
            margin-top: 1.5rem;
            margin-bottom: 0.75rem;
        }
        h5 { /* Minor heading */
            font-size: 1.1rem; /* text-lg */
            font-weight: 600;
            color: #334155; /* text-slate-700 */
            margin-top: 1rem;
            margin-bottom: 0.5rem;
        }
        p, li {
            line-height: 1.75;
            margin-bottom: 1rem; /* Increased margin */
            color: #475569; /* text-slate-600 */
        }
        ul, ol {
            margin-left: 1.5rem; /* Add left margin to lists */
            margin-bottom: 1rem;
        }
        pre {
            background-color: #1e293b; /* bg-slate-800 */
            color: #e2e8f0; /* text-slate-200 */
            padding: 1rem;
            border-radius: 0.375rem;
            overflow-x: auto;
            margin-top: 0.5rem; /* Added margin-top */
            margin-bottom: 1rem;
            position: relative;
        }
        code {
            font-family: 'Menlo', 'Monaco', 'Courier New', monospace;
            font-size: 0.9em;
            background-color: rgba(226, 232, 240, 0.5); /* bg-slate-200 with opacity for inline code */
            padding: 0.125rem 0.25rem; /* py-0.5 px-1 */
            border-radius: 0.25rem; /* rounded-sm */
        }
        pre code {
            font-size: 0.85em;
            background-color: transparent; /* No background for code inside pre */
            padding: 0;
        }
        .copy-btn {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            background-color: #334155; /* bg-slate-700 */
            color: white;
            border: none;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            cursor: pointer;
            font-size: 0.75rem;
            opacity: 0.7;
            transition: opacity 0.2s;
        }
        pre:hover .copy-btn {
            opacity: 1;
        }
        .copy-btn:hover {
            background-color: #475569; /* bg-slate-600 */
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 1rem;
            font-size: 0.9rem;
        }
        th, td {
            border: 1px solid #cbd5e1; /* border-slate-300 */
            padding: 0.75rem;
            text-align: left;
        }
        th {
            background-color: #f1f5f9; /* bg-slate-100 */
            font-weight: 600;
        }
        .collapsible-header {
            cursor: pointer;
            background-color: #f1f5f9; /* bg-slate-100 */
            padding: 0.75rem 1rem; /* Increased padding */
            border-radius: 0.375rem;
            margin-bottom: 0.1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 600;
            transition: background-color 0.2s;
        }
        .collapsible-header:hover {
            background-color: #e2e8f0; /* bg-slate-200 */
        }
        .collapsible-content {
            display: none;
            padding: 1rem 1.5rem; /* Increased padding */
            border: 1px solid #e2e8f0; /* border-slate-200 */
            border-top: none;
            border-radius: 0 0 0.375rem 0.375rem;
            margin-bottom: 1rem; /* Increased margin */
            background-color: #ffffff; /* white background */
        }
        .collapsible-content.open {
            display: block;
        }
        .arrow {
            transition: transform 0.2s ease-in-out;
        }
        .collapsible-content.open + .collapsible-header .arrow { /* This selector might need adjustment if structure changes */
            transform: rotate(180deg);
        }
        /* Alert Styles */
        .alert-info {
            background-color: #e0f2fe; /* sky-100 */
            border-left-width: 4px;
            border-color: #0ea5e9; /* sky-500 */
            padding: 1rem;
            margin-bottom: 1rem;
            color: #0c4a6e; /* sky-800 */
            border-radius: 0 0.375rem 0.375rem 0;
        }
        .alert-warning {
            background-color: #fef9c3; /* yellow-100 */
            border-left-width: 4px;
            border-color: #facc15; /* yellow-400 */
            padding: 1rem;
            margin-bottom: 1rem;
            color: #713f12; /* yellow-800 */
            border-radius: 0 0.375rem 0.375rem 0;
        }
        .alert-danger {
            background-color: #fee2e2; /* red-100 */
            border-left-width: 4px;
            border-color: #ef4444; /* red-500 */
            padding: 1rem;
            margin-bottom: 1rem;
            color: #991b1b; /* red-800 */
            border-radius: 0 0.375rem 0.375rem 0;
        }
        .alert-success { /* New style */
            background-color: #d1fae5; /* green-100 */
            border-left-width: 4px;
            border-color: #10b981; /* green-500 */
            padding: 1rem;
            margin-bottom: 1rem;
            color: #047857; /* green-800 */
            border-radius: 0 0.375rem 0.375rem 0;
        }
        .tag {
            display: inline-block;
            background-color: #e0f2fe; /* sky-100 */
            color: #0ea5e9; /* sky-500 */
            padding: 0.25rem 0.75rem;
            border-radius: 9999px; /* rounded-full */
            font-size: 0.875rem; /* text-sm */
            font-weight: 500;
            margin-right: 0.5rem;
            margin-bottom: 0.5rem;
        }
        .gemini-feature-card {
            background-color: white;
            border-radius: 0.5rem; /* rounded-lg */
            padding: 1.5rem; /* p-6 */
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -1px rgba(0,0,0,0.06); /* shadow-md */
            margin-top: 1.5rem;
            margin-bottom: 1.5rem;
        }
        .gemini-feature-card textarea {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #cbd5e1; /* border-slate-300 */
            border-radius: 0.375rem; /* rounded-md */
            min-height: 100px;
            margin-bottom: 1rem;
            background-color: #f8fafc; /* bg-slate-50 */
            color: #334155; /* text-slate-700 */
        }
        .gemini-feature-card button {
            background-color: #0ea5e9; /* bg-sky-500 */
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.375rem; /* rounded-md */
            font-weight: 600;
            transition: background-color 0.2s;
        }
        .gemini-feature-card button:hover {
            background-color: #0284c7; /* bg-sky-600 */
        }
        .gemini-feature-card button:disabled {
            background-color: #94a3b8; /* bg-slate-400 */
            cursor: not-allowed;
        }
        .loading-spinner {
            border: 4px solid #f3f3f3; /* Light grey */
            border-top: 4px solid #0ea5e9; /* Sky blue */
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
            margin: 1rem auto;
            display: none; /* Hidden by default */
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        /* Custom scrollbar for nav */
        nav::-webkit-scrollbar {
            width: 8px;
        }
        nav::-webkit-scrollbar-track {
            background: #f1f5f9; /* bg-slate-100 */
            border-radius: 10px;
        }
        nav::-webkit-scrollbar-thumb {
            background: #cbd5e1; /* bg-slate-300 */
            border-radius: 10px;
        }
        nav::-webkit-scrollbar-thumb:hover {
            background: #94a3b8; /* bg-slate-400 */
        }
        .link-external::after {
            content: ' ↗';
            font-size: 0.8em;
            vertical-align: super;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-700">

<div class="flex flex-col md:flex-row min-h-screen">
    <nav class="md:w-80 bg-white shadow-lg p-4 space-y-1 md:sticky md:top-0 md:h-screen overflow-y-auto">
        <h1 class="main-title">Cursor IDE: PHP/Laravel Гайд</h1>
        <span class="block text-xs text-center text-slate-400 mb-3">(Обновлено: 29 Мая 2025)</span>
        <a class="nav-link block" data-target="introduction">Введение</a>
        <a class="nav-link block" data-target="installation">1. Установка и Настройка</a>
        <a class="nav-link block" data-target="project-config">2. Конфигурация Проекта</a>
        <a class="nav-link block" data-target="rules">3. Освоение Cursor Rules</a>
        <a class="nav-link block" data-target="context-at">4. Управление Контекстом (@)</a>
        <a class="nav-link block" data-target="ai-assisted-dev">5. AI-Ассистированная Разработка</a>
        <a class="nav-link block" data-target="advanced-php-laravel">6. Продвинутая PHP/Laravel Разработка</a>
        <a class="nav-link block" data-target="mcp-servers">7. MCP Серверы</a>
        <a class="nav-link block" data-target="debugging">8. Отладка (Xdebug)</a>
        <a class="nav-link block" data-target="laravel-ecosystem">9. Экосистема Laravel</a>
        <a class="nav-link block" data-target="security">10. Безопасность с ИИ</a>
        <a class="nav-link block" data-target="tips-tricks">11. Советы и Трюки</a>
        <a class="nav-link block" data-target="useful-links">12. Полезные Ссылки</a>
        <a class="nav-link block" data-target="conclusion">13. Заключение</a>
    </nav>

    <main class="flex-1 p-6 md:p-10 overflow-y-auto">
        <section id="introduction" class="content-section">
            <h2>Введение в Cursor для PHP/Laravel разработчиков</h2>
            <p>Добро пожаловать в обновленное и дополненное интерактивное руководство по Cursor IDE для PHP и Laravel (актуальность: 29 Мая 2025)! Это приложение создано, чтобы помочь вам быстро освоить все тонкости использования Cursor IDE, превратив его в вашего незаменимого AI-ассистента в повседневной разработке.</p>
            <p>Cursor IDE, построенный на основе VS Code, предлагает глубокую интеграцию с искусственным интеллектом, что может кардинально повысить вашу продуктивность. Здесь вы найдете исчерпывающую информацию: от первоначальной установки и настройки среды PHP/Laravel до продвинутых техник работы с AI, управления контекстом проекта, использования правил (<code>.cursor/rules/*.mdc</code>), интеграции с MCP-серверами (включая инновационный OpenMemory MCP), отладки с Xdebug и эффективного взаимодействия с экосистемой Laravel (Composer, Artisan, Sail/Herd).</p>
            <p>Мы рассмотрим как базовые, так и продвинутые техники, которые позволят вам "взлететь" и начать пользоваться всеми преимуществами Cursor. Используйте навигацию слева, чтобы перемещаться по разделам. Каждый раздел содержит ключевую информацию, примеры кода, практические советы и ✨ AI-помощников на базе Gemini API для генерации правил и промптов.</p>

            <h3>Почему Cursor для разработки на РНР и Laravel?</h3>
            <p>Cursor предлагает ускорение циклов разработки, улучшение качества кода за счет интеллектуальных предложений и автоматизированного рефакторинга, а также помощь в освоении и реализации сложных функций Laravel. Хотя начальное освоение может потребовать времени, долгосрочный выигрыш в производительности часто оказывается значительным. Важно понимать, что Cursor — это интеллектуальный ассистент, расширяющий ваши возможности, а не полная замена разработчика.</p>
            <div class="alert-success">
                <p><strong>Совет:</strong> Начните с интеграции Cursor в небольшие задачи или проекты, чтобы постепенно освоить его возможности и выработать эффективные паттерны взаимодействия с AI.</p>
            </div>
            <h3>Cursor в сравнении с традиционными IDE (например, PhpStorm)</h3>
            <p>PhpStorm славится мощной встроенной поддержкой PHP/Laravel. Cursor выделяется передовыми AI-функциями, но его базовая IDE-функциональность для PHP/Laravel зависит от расширений VS Code. Максимальная эффективность Cursor достигается за счет синергии его AI-возможностей и богатой экосистемы расширений. Этот гайд поможет вам настроить такую синергию.</p>
        </section>

        <section id="installation" class="content-section">
            <h2>1. Установка и Первоначальная Настройка Среды</h2>
            <p>Этот раздел поможет вам установить и настроить Cursor IDE для эффективной работы с PHP и Laravel проектами. Cursor доступен для macOS, Windows и Linux.</p>

            <h3>1.1. Установка Cursor IDE</h3>
            <ul class="list-disc">
                <li>Загрузите установочный файл с официального сайта <a href="https://cursor.com" target="_blank" class="text-sky-600 hover:underline link-external">cursor.com</a>.</li>
                <li>Запустите установщик и следуйте инструкциям.</li>
                <li>При первом запуске Cursor предложит импортировать настройки и расширения из VS Code. Это рекомендуется для плавного перехода.</li>
            </ul>

            <h3>1.2. Мастер первоначальной конфигурации</h3>
            <p>После установки Cursor проведет через краткий мастер настройки:</p>
            <ul class="list-disc">
                <li><strong>Сочетания клавиш:</strong> По умолчанию используются сочетания VS Code.</li>
                <li><strong>Язык для ИИ:</strong> Можно выбрать язык для взаимодействия с AI.</li>
                <li><strong>Контекст всей кодовой базы:</strong> Важно включить эту опцию для полноценной работы AI.</li>
                <li><strong>Добавление команды терминала:</strong> Позволяет запускать Cursor из командной строки (например, <code>cursor .</code>).</li>
            </ul>

            <h3>1.3. Настройка среды PHP</h3>
            <p>Качество работы AI-ассистента Cursor напрямую зависит от полноты настройки базовой среды PHP и установленных расширений VS Code.</p>

            <div class="collapsible-header">
                <span>1.3.1. Конфигурация интерпретатора PHP</span>
                <span class="arrow">▼</span>
            </div>
            <div class="collapsible-content">
                <p>Укажите путь к исполняемому файлу PHP в настройках Cursor (<code>settings.json</code>, доступен через <code>Ctrl/⌘ + ,</code>, поиск "php.validate.executablePath"). Это критично для валидации кода и устранения предупреждений об отсутствии PHP.</p>
                <pre><code class="language-json">{
    "php.validate.executablePath": "/usr/bin/php", // Замените на ваш путь (например, /opt/homebrew/bin/php или C:\\php\\php.exe для PHP 8.3+)
    "php.suggest.basic": false, // Рекомендуется отключить базовые PHP-подсказки VS Code в пользу Intelephense
    "php.validate.run": "onType" // или "onSave" - для линтинга при наборе или сохранении
}</code><button class="copy-btn">Копировать</button></pre>
                <p>Эта настройка указывает Cursor путь к исполняемому файлу РНР, что критично для валидации кода и устранения предупреждений об отсутствии РНР.</p>
            </div>

            <h3>1.4. Основные расширения VS Code для PHP/Laravel в Cursor</h3>
            <p>Cursor активно использует маркетплейс расширений VS Code. Установите их через панель расширений (<code>Ctrl/⌘ + Shift + X</code>). Ниже приведен обновленный и аннотированный список (актуально на 29 Мая 2025):</p>
            <div class="overflow-x-auto">
                <table>
                    <thead>
                    <tr>
                        <th>Название расширения</th>
                        <th>Издатель</th>
                        <th>Ключевые функции и Примечания</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td>PHP Intelephense</td>
                        <td>bmewburn</td>
                        <td>Интеллектуальный анализ кода, автодополнение, переход к определению, поиск ссылок. Freemium. Отключите встроенные функции PHP VS Code для оптимальной работы. (Проверено на актуальность)</td>
                    </tr>
                    <tr>
                        <td>PHP Debug</td>
                        <td>Xdebug Team (ранее Derick Rethans)</td>
                        <td>Официальное расширение Xdebug, критически важное для отладки. (Проверено на актуальность)</td>
                    </tr>
                    <tr>
                        <td>Official Laravel Extension</td>
                        <td>laravel</td>
                        <td>Обширные функции для Laravel: автодополнение (Eloquent, маршруты, представления, конфигурации), прямые ссылки, диагностика. Требует PHP >= 8.1 (для последних версий Laravel 11/12). (Проверено на актуальность)</td>
                    </tr>
                    <tr>
                        <td>Laravel Blade Snippets</td>
                        <td>onecentlin (или аналоги)</td>
                        <td>Подсветка синтаксиса Blade и распространенные сниппеты. (Проверено на актуальность)</td>
                    </tr>
                    <tr>
                        <td>PHP DocBlocker</td>
                        <td>neilbrayfield</td>
                        <td>Эффективная генерация PHPDoc блоков, улучшает читаемость и контекст для AI. (Проверено на актуальность)</td>
                    </tr>
                    <tr>
                        <td>PHP Namespace Resolver</td>
                        <td>Mehedi Dracula</td>
                        <td>Упрощение импорта пространств имен. (Проверено на актуальность)</td>
                    </tr>
                    <tr>
                        <td>Error Lens</td>
                        <td>usernamehw</td>
                        <td>Улучшенная встроенная визуализация ошибок. (Проверено на актуальность)</td>
                    </tr>
                    <tr>
                        <td>DotENV</td>
                        <td>mikestead</td>
                        <td>Подсветка синтаксиса для файлов <code>.env</code>. (Проверено на актуальность)</td>
                    </tr>
                    <tr>
                        <td>GitLens</td>
                        <td>GitKraken</td>
                        <td>Расширенные возможности Git внутри IDE. (Проверено на актуальность)</td>
                    </tr>
                    <tr>
                        <td>EditorConfig for VS Code</td>
                        <td>EditorConfig</td>
                        <td>Поддержание единого стиля кодирования. (Проверено на актуальность)</td>
                    </tr>
                    <tr>
                        <td>Laravel Pint</td>
                        <td>open-southeners</td>
                        <td>Интеграция с Laravel Pint для автоматического форматирования кода. (Актуально и рекомендуется)</td>
                    </tr>
                    </tbody>
                </table>
            </div>
            <div class="alert-info mt-4">
                <p><strong>Важно: Пакет <code>barryvdh/laravel-ide-helper</code></strong></p>
                <p>Хотя это пакет Composer, а не расширение VS Code, его сгенерированные файлы-помощники жизненно важны для IDE (и, следовательно, для AI Cursor) для понимания «магических» методов Laravel (фасады, конструкторы Eloquent и т.д.). Это значительно улучшает автодополнение и точность AI.</p>
                <p>Установите его: <code>composer require --dev barryvdh/laravel-ide-helper</code> и регулярно генерируйте хелперы:</p>
                <pre><code class="language-bash">php artisan ide-helper:generate
php artisan ide-helper:models -W # Запись напрямую в файлы моделей (используйте с осторожностью, если модели кастомизированы)
php artisan ide-helper:meta</code><button class="copy-btn">Копировать</button></pre>
            </div>
            <p>Качество помощи ИИ в Cursor для PHP/Laravel не зависит исключительно от модели ИИ, а значительно усиливается контекстной информацией, предоставляемой правильно настроенной средой, особенно языковыми серверами и специализированными расширениями.</p>
        </section>

        <section id="project-config" class="content-section">
            <h2>2. Конфигурирование Проекта в Cursor</h2>
            <p>Адаптация поведения Cursor к каждому проекту критически важна. Основными механизмами для этого служат директория <code>.cursor</code> в корне вашего проекта и файл настроек <code>.vscode/settings.json</code>.</p>

            <h3>2.1. Директория `.cursor`: Правила и Игнорирование</h3>
            <p>Эта директория содержит конфигурации, специфичные для AI Cursor.</p>

            <div class="collapsible-header">
                <span>2.1.1. Файлы `.cursor/rules/*.mdc` (Правила Проекта)</span>
                <span class="arrow">▼</span>
            </div>
            <div class="collapsible-content">
                <p>Это критически важная функция для адаптации поведения ИИ. Правила позволяют кодировать специфичные для домена знания, стандарты кодирования и архитектурные паттерны. Подробно они будут рассмотрены в следующем разделе.</p>
            </div>

            <div class="collapsible-header">
                <span>2.1.2. Файлы `.cursorignore` и `.cursorindexingignore`</span>
                <span class="arrow">▼</span>
            </div>
            <div class="collapsible-content">
                <p>Эти файлы контролируют, какие директории и файлы Cursor может индексировать и использовать в качестве контекста. Это важно для безопасности и производительности.</p>
                <h4>Назначение и безопасность:</h4>
                <ul class="list-disc">
                    <li><strong><code>.cursorignore</code>:</strong> Предотвращает утечку конфиденциальной информации (например, из <code>.env</code> файла) в контекст AI. Файлы, указанные здесь, исключаются как из индексации, так и из доступа AI-функциями (Chat, Tab, Cmd+K, @-ссылки). Это более безопасный вариант.</li>
                    <li><strong><code>.cursorindexingignore</code>:</strong> Файлы исключаются только из индексации, но AI все еще может получить к ним доступ, если на них есть явная ссылка или AI сочтет их релевантными.</li>
                </ul>
                <div class="alert-danger">
                    <strong>Критически важно для безопасности:</strong> Всегда добавляйте <code>.env*</code> и другие файлы с секретами в <code>.cursorignore</code>.
                </div>
                <h4>Производительность и синтаксис:</h4>
                <p>В больших проектах исключение нерелевантных частей (<code>node_modules/</code>, <code>vendor/</code>, директории сборки, большие логи) ускоряет индексацию и повышает точность контекста для AI. Синтаксис идентичен <code>.gitignore</code>.</p>
                <p>Пример <code>.cursorignore</code> для Laravel:</p>
                <pre><code class="language-text"># Конфиденциальные файлы
.env*
*.pem
*.key
credentials.json
storage/oauth-*.key

# Зависимости и сгенерированные файлы
/vendor/
/node_modules/
/public/build/
/public/hot
/public/storage/ # Часто симлинк на storage/app/public
/storage/app/public/ # Если не используется для публичного доступа через симлинк
/storage/framework/cache/data/
/storage/framework/sessions/
/storage/framework/views/
/storage/logs/*.log
bootstrap/cache/*.php
!/storage/logs/important.log # Пример отмены игнорирования

# IDE-специфичные файлы (если не в .gitignore)
.idea/
# .vscode/ # Обычно не игнорируется, т.к. может содержать settings.json

# Другое
*.lock
composer.phar
npm-debug.log*
yarn-debug.log*
yarn-error.log*</code><button class="copy-btn">Копировать</button></pre>
                <h4>Поведение по умолчанию и разрешение проблем:</h4>
                <p>Cursor по умолчанию учитывает правила из файла <code>.gitignore</code> вашего проекта. Он также имеет свой внутренний список игнорируемых файлов (например, <code>package-lock.json</code>, <code>composer.lock</code>, <code>.env*</code>). Вы можете отменить игнорирование с помощью префикса <code>!</code> (например, <code>!storage/logs/important.log</code>).</p>
                <p>Пользователи могут определять глобальные шаблоны игнорирования в настройках Cursor на уровне пользователя. Также есть настройка, позволяющая Cursor искать файлы <code>.cursorignore</code> вверх по дереву каталогов, что полезно для вложенных проектов.</p>
            </div>

            <div class="collapsible-header">
                <span>2.1.3. Файл `.cursor/mcp.json` (Конфигурация MCP-серверов)</span>
                <span class="arrow">▼</span>
            </div>
            <div class="collapsible-content">
                <p>Этот файл используется для настройки Model Context Protocol (MCP) серверов для конкретного проекта. Подробнее об этом в разделе "MCP Серверы".</p>
            </div>

            <h3>2.2. Настройки Редактора (`.vscode/settings.json`) и Рабочие Области</h3>
            <p>Cursor, будучи форком VS Code, использует ту же систему настроек.</p>
            <div class="collapsible-header">
                <span>2.2.1. Файл `settings.json` (Пользовательские и Рабочие Области)</span>
                <span class="arrow">▼</span>
            </div>
            <div class="collapsible-content">
                <p>Объясните иерархию настроек: Пользовательские (глобальные) vs. Рабочая область (проект). Доступ через <code>Ctrl/⌘ + ,</code>.</p>
                <p>Примеры настроек, релевантных для PHP/Laravel, которые можно поместить в <code>.vscode/settings.json</code> рабочей области (помимо <code>php.validate.executablePath</code>):</p>
                <pre><code class="language-json">{
    "editor.formatOnSave": true,
    "[php]": {
        "editor.defaultFormatter": "bmewburn.vscode-intelephense-client", // Или "open-southeners.laravel-pint" если Pint настроен
    },
    "laravel-pint.enable": true, // Если используется расширение Laravel Pint
    // "laravel-pint.configPath": "pint.json", // Если есть кастомный pint.json
    "intelephense.environment.phpVersion": "8.3", // Укажите вашу актуальную версию PHP (например, 8.3 или 8.4)
    "intelephense.stubs": [ // Дополнительные стабы для лучшего автодополнения
        "apache",
        "bcmath",
        "bz2",
        "calendar",
        "ctype",
        "curl",
        "date",
        "dba",
        "dom",
        "exif",
        "fileinfo",
        "filter",
        "ftp",
        "gd",
        "gettext",
        "hash",
        "iconv",
        "intl",
        "json",
        "ldap",
        "libxml",
        "mbstring",
        "mysqli",
        "mysqlnd",
        "openssl",
        "pcntl",
        "pcre",
        "pdo",
        "pdo_mysql",
        "pdo_pgsql",
        "pdo_sqlite",
        "pgsql",
        "phar",
        "posix",
        "readline",
        "redis", // Если используете Redis
        "session",
        "shmop",
        "simplexml",
        "soap",
        "sockets",
        "sodium",
        "spl",
        "sqlite3",
        "standard",
        "sysvmsg",
        "sysvsem",
        "sysvshm",
        "tidy",
        "tokenizer",
        "xml",
        "xmlreader",
        "xmlrpc",
        "xmlwriter",
        "xsl",
        "zip",
        "zlib",
        "wordpress", // Если работаете с WordPress
        "laravel", // Intelephense имеет встроенные стабы для Laravel
        "xdebug" // Для автодополнения функций Xdebug
    ],
    "files.exclude": { // Исключение файлов из проводника (не для AI)
        "**/.git": true,
        "**/node_modules": true,
        "**/vendor": true,
        "**/public/build": true,
        "**/public/hot": true
    },
    "files.associations": {
        "*.blade.php": "blade",
        "*.mdc": "markdown" // Для подсветки синтаксиса правил Cursor
    },
    "emmet.includeLanguages": {
        "blade": "html"
    }
}</code><button class="copy-btn">Копировать</button></pre>
            </div>

            <div class="collapsible-header">
                <span>2.2.2. Многокорневые Рабочие Области (Multi-root Workspaces)</span>
                <span class="arrow">▼</span>
            </div>
            <div class="collapsible-content">
                <p>Это функция, унаследованная от VS Code (актуально на Май 2025), позволяющая работать с несколькими папками проекта в одном окне Cursor. Особенно полезно для проектов Laravel, включающих отдельные пакеты, фронтенд-приложения или микросервисы.</p>
                <ul class="list-disc">
                    <li>Создание и сохранение рабочих областей (<code>.code-workspace</code> файл).</li>
                    <li><code>.cursor/rules</code> поддерживаются во всех добавленных папках.</li>
                    <li>Настройки (<code>settings.json</code>) и отладка (<code>launch.json</code>) работают в контексте многокорневых рабочих областей.</li>
                    <li><strong>Пример для Laravel:</strong> рабочая область, включающая основной проект Laravel и отдельный пакет Composer, разрабатываемый для этого проекта.</li>
                </ul>
                <p>Это позволяет точно настроить среду разработки под каждый проект и улучшает способность ИИ понимать взаимосвязи между различными частями сложного проекта.</p>
            </div>
            <h3>2.3. Общий конфигурационный файл `.cursor` (YAML/JSON) - Проверка концепции</h3>
            <p>Некоторые руководства предполагают использование единого YAML/JSON файла <code>.cursor</code> в корне проекта для определения <code>project_info</code>, <code>ai_personality</code>, <code>code_style</code>. По состоянию на май 2025 года, официальная документация Cursor акцентирует внимание на <code>.cursor/rules/*.mdc</code> для детальных инструкций ИИ и <code>.cursor/mcp.json</code> для MCP.</p>
            <div class="alert-info">
                <p><strong>Рекомендация:</strong> Информацию о проекте (<code>project_info</code>), "личность" ИИ (<code>ai_personality</code>) и руководства по стилю кода (<code>code_style</code>) рекомендуется кодировать в файлах <code>.cursor/rules/*.mdc</code>, вероятно, как правила типа <code>Always</code> или <code>Auto Attached</code>. Например, правило <code>architecture-overview.mdc</code> может содержать <code>project_info</code>, а <code>style-and-tone.mdc</code> — предпочтения по стилю кода и тону ответов ИИ. Этот подход соответствует документированным функциям Cursor.</p>
            </div>

        </section>

        <section id="rules" class="content-section">
            <h2>3. Освоение Cursor Rules (`.cursor/rules/*.mdc`)</h2>
            <p>Cursor Rules — это многократно используемые, версионируемые инструкции для управления поведением AI-агента (Agent) и функции Cmd+K. Они хранятся в <code>.cursor/rules/</code> в виде файлов <code>.mdc</code> (Markdown Components) и позволяют кодировать специфичные для домена знания, автоматизировать рабочие процессы и стандартизировать стиль или архитектуру.</p>

            <h3>3.1. Структура и типы правил</h3>
            <p>Файл <code>.mdc</code> содержит YAML frontmatter (метаданные) и Markdown содержимое (непосредственно правило).</p>
            <pre><code class="language-yaml">---
# YAML Frontmatter
description: "Необязательное описание для правил типа Agent Requested. Помогает AI понять, когда использовать это правило."
globs: ["app/Http/Controllers/**/*.php", "*.blade.php"] # Опционально. Для правил типа Auto Attached. Указывает, к каким файлам правило применяется автоматически.
alwaysApply: false # Установите true для правил типа Always.
tags: ["laravel", "controller", "best-practice"] # Опционально: теги для организации и поиска правил
---
# Rule Content Starts Here (Markdown)
- Это основное содержание вашего правила.
- Используйте этот специфический паттерн или библиотеку при работе с файлами, соответствующими `globs`.
- Ссылайтесь на другие файлы в проекте, если нужно: @app/Services/MyService.php
- Приводите примеры кода, если это помогает:
  ```php
  // Пример хорошего кода
  public function index(Request $request) { ... }
  ```</code><button class="copy-btn">Копировать</button></pre>

            <h4>Типы применения правил:</h4>
            <ul class="list-disc">
                <li><strong><code>Always</code> (Всегда):</strong> <code>alwaysApply: true</code>. Правило всегда включается в контекст AI. Подходит для общих стандартов проекта.</li>
                <li><strong><code>Auto Attached</code> (Автоматически присоединяемые):</strong> Определяется через <code>globs: ["pattern1", "pattern2"]</code>. Правило активируется, когда файлы, соответствующие указанным паттернам (globs), находятся в контексте AI.</li>
                <li><strong><code>Agent Requested</code> (Запрашиваемые агентом):</strong> Определяется через <code>description: "Описание назначения правила"</code>. AI сам решает, использовать ли это правило, основываясь на его описании и текущей задаче.</li>
                <li><strong><code>Manual</code> (Ручные):</strong> Если <code>alwaysApply: false</code> (или отсутствует) и нет <code>globs</code> или <code>description</code>. Правило включается только при явном упоминании его имени в чате или промпте через <code>@имяПравила</code> (имя файла без расширения <code>.mdc</code>).</li>
            </ul>
            <p>Поддерживаются также вложенные правила (директории <code>.cursor/rules/</code> внутри поддиректорий проекта) для специфичного для домена руководства в больших проектах или монорепозиториях.</p>
            <p><strong>Последние обновления (Май 2025):</strong> Агент теперь автоматически применяет правила <code>Auto Attached</code> при чтении/записи файлов и может надежно редактировать правила. Правила <code>Always</code> теперь дольше сохраняются в контексте длительных диалогов. Добавлена поддержка тегов (<code>tags</code>) в YAML frontmatter для лучшей организации правил.</p>


            <h3>3.2. Лучшие практики написания правил для Laravel/PHP</h3>
            <ul class="list-disc">
                <li><strong>Конкретность и действенность:</strong> Указывайте AI точно, что делать или чего избегать. Вместо "пиши хороший код" лучше "используй строгую типизацию и Form Requests для валидации в контроллерах".</li>
                <li><strong>Краткость:</strong> Стремитесь к ясности, но избегайте излишней многословности. Идеально до 500 строк.</li>
                <li><strong>Примеры:</strong> Включайте короткие, релевантные фрагменты кода или ссылки на файлы (<code>@app/Models/User.php</code>).</li>
                <li><strong>Декомпозиция:</strong> Разбивайте сложные стандарты (например, весь PSR-12) на более мелкие, сфокусированные правила (например, одно правило для именования, другое для структуры класса).</li>
                <li><strong>Четкие описания:</strong> Для правил типа <code>Agent Requested</code> пишите понятные описания, чтобы AI мог правильно их выбирать.</li>
                <li><strong>Итеративность:</strong> Тестируйте и уточняйте правила на основе производительности AI.</li>
                <li><strong>Фокус на Laravel/PHP:</strong> Отражайте конвенции Laravel (Eloquent, Repository/Service паттерны, маршрутизация, валидация). Не дублируйте общие знания AI о PHP. Учитывайте актуальные версии Laravel (11/12) и PHP (8.2/8.3/8.4).</li>
                <li><strong>Использование команд:</strong> Можно создавать правила вручную или через палитру команд ("New Cursor Rule"), а также генерировать их из чат-диалогов с помощью команды <code>/Generate Cursor Rules</code>.</li>
            </ul>

            <h3>3.3. Примеры правил проекта для Laravel/PHP</h3>
            <p>Ниже приведены примеры, которые можно адаптировать для вашего проекта. Рекомендуется хранить каждое логически обособленное правило в отдельном <code>.mdc</code> файле в директории <code>.cursor/rules/</code>.</p>

            <div class="collapsible-header">
                <span>Пример: `laravel-conventions.mdc` (Общие соглашения Laravel)</span>
                <span class="arrow">▼</span>
            </div>
            <div class="collapsible-content">
                    <pre><code class="language-yaml">---
alwaysApply: true
description: "Общие лучшие практики и ключевые принципы для разработки на Laravel в этом проекте. Применяется ко всем PHP файлам."
globs: ["**/*.php"]
tags: ["laravel", "general", "psr12", "php8.3"]
---
# Ключевые принципы и соглашения Laravel
- Код должен соответствовать стандарту PSR-12.
- Всегда используйте строгую типизацию: `declare(strict_types=1);` в начале PHP файлов.
- Используйте возможности PHP 8.3+ (например, атрибут `#[Override]`, типизированные константы классов, `json_validate()`).
- Предпочитайте внедрение зависимостей (Dependency Injection) через конструктор или методы.
- Для доступа к конфигурации используйте хелпер `config('filename.key')` вместо `env('KEY')` в коде приложения.
- Избегайте N+1 запросов при работе с Eloquent, активно используйте eager loading (`with()`).
- Для моделей, которые не должны удаляться окончательно, реализуйте soft deletes (`use SoftDeletes;`).
- **Для Laravel 11/12**: Помните, что файл `app/Console/Kernel.php` может отсутствовать; используйте `bootstrap/app.php` для соответствующих конфигураций консоли. Команды в `app/Console/Commands/` регистрируются автоматически. Для Laravel 12, если используются новые возможности (например, "Precise Routing" или новый формат конфигурации), отразите это.
- Пишите осмысленные комментарии PHPDoc для всех публичных методов и свойств.
- Используйте Laravel Pint для форматирования кода с конфигурацией по умолчанию или проектной `pint.json`.</code><button class="copy-btn">Копировать</button></pre>
            </div>

            <div class="collapsible-header">
                <span>Пример: `controller-guidelines.mdc` (Правила для контроллеров)</span>
                <span class="arrow">▼</span>
            </div>
            <div class="collapsible-content">
                    <pre><code class="language-yaml">---
globs: ["app/Http/Controllers/**/*.php"]
alwaysApply: false # Будет Auto Attached для файлов контроллеров
description: "Руководство по стилю и проектированию контроллеров Laravel в этом проекте."
tags: ["laravel", "controller", "architecture"]
---
# Проектирование контроллеров Laravel
- Контроллеры должны быть "тонкими", делегируя бизнес-логику сервисным классам (в `app/Services/`) или Action-классам (в `app/Actions/`).
- Используйте Form Requests (в `app/Http/Requests/`) для валидации всех входящих данных.
- Для CRUD операций придерживайтесь стандартных имен методов: `index`, `create`, `store`, `show`, `edit`, `update`, `destroy`.
- Возвращайте стандартизированные ответы:
    - Для веб-маршрутов: `view()`, `redirect()`.
    - Для API-маршрутов: `response()->json()` или API Resources (в `app/Http/Resources/`).
- Используйте внедрение зависимостей через конструктор для сервисов и других зависимостей.
- Пример структуры метода store:
  ```php
  public function store(StoreProductRequest $request, ProductService $productService)
  {
      $productDTO = ProductData::fromRequest($request); // Пример использования DTO
      $product = $productService->create($productDTO);
      return redirect()->route('products.show', $product)->with('success', 'Продукт успешно создан.');
      // или для API: return new ProductResource($product);
  }
  ```
- Используйте явную привязку модели (Route Model Binding), где это уместно.
  Пример: `public function show(Product $product)`</code><button class="copy-btn">Копировать</button></pre>
            </div>

            <div class="collapsible-header">
                <span>Пример: `eloquent-model-guidelines.mdc` (Правила для моделей Eloquent)</span>
                <span class="arrow">▼</span>
            </div>
            <div class="collapsible-content">
                    <pre><code class="language-yaml">---
globs: ["app/Models/**/*.php"]
alwaysApply: false # Auto Attached для файлов моделей
description: "Рекомендации по созданию и использованию моделей Eloquent."
tags: ["laravel", "eloquent", "model", "database"]
---
# Проектирование моделей Eloquent
- Явно определяйте свойства `$fillable` или `$guarded` для защиты от массового присваивания.
- Четко определяйте отношения Eloquent (`hasOne`, `hasMany`, `belongsTo`, `belongsToMany`, etc.) с корректными типами возвращаемых значений в PHPDoc (например, `/** @return \Illuminate\Database\Eloquent\Relations\HasMany<Post> */`). В PHP 8+ используйте генерики в PHPDoc.
- Добавляйте PHPDoc к свойствам модели, особенно для "магических" атрибутов, если `laravel-ide-helper` не используется или его информации недостаточно.
- Используйте типажи, такие как `HasFactory`, `SoftDeletes`, `HasUuids` (для Laravel 9+), `Notifiable` где это необходимо.
- Кастомные аксессоры и мутаторы (атрибуты `Attribute::make()` в Laravel 9+) должны быть хорошо документированы и иметь ясное назначение.
- Для сложных запросов, специфичных для модели, используйте Query Scopes.
- Избегайте размещения сложной бизнес-логики непосредственно в моделях; выносите ее в сервисы или actions.
- Пример определения отношения с генериками PHP 8+:
  ```php
  use Illuminate\Database\Eloquent\Relations\HasMany;

  /**
   * Получить все посты пользователя.
   * @return HasMany<Post>
   */
  public function posts(): HasMany
  {
      return $this->hasMany(Post::class);
  }
  ```</code><button class="copy-btn">Копировать</button></pre>
            </div>

            <div class="collapsible-header">
                <span>Пример: `api-resource-guidelines.mdc` (Правила для API Resources)</span>
                <span class="arrow">▼</span>
            </div>
            <div class="collapsible-content">
                    <pre><code class="language-yaml">---
globs: ["app/Http/Resources/**/*.php"]
alwaysApply: false # Auto Attached
description: "Стандарты для создания Laravel API Resources для форматирования JSON-ответов."
tags: ["laravel", "api", "resource", "json"]
---
# Руководство по Laravel API Resources
- Используйте API Resources для форматирования ответов Eloquent моделей и коллекций в API.
- Создавайте ресурс для каждой основной модели (например, `UserResource`, `ProductResource`).
- Для коллекций используйте `YourResource::collection($items)`.
- Явно определяйте поля, которые должны быть возвращены в методе `toArray(Request $request): array`.
- Используйте `whenLoaded()` для условного включения связанных данных, чтобы избежать N+1 проблем и не загружать ненужные связи.
  Пример: `'user' => new UserResource($this->whenLoaded('user'))`
- Для метаданных ответа (например, ссылки пагинации, кастомные мета-поля) используйте метод `with(Request $request): array` в ресурсе или ресурсе коллекции.
- Сохраняйте консистентность в структуре ответа по всему API.
- Не включайте чувствительные данные в API ресурсы без необходимости (например, `email_verified_at`, `remember_token`).
- Пример простого ресурса для Laravel 11/12:
  ```php
  namespace App\Http\Resources;

  use Illuminate\Http\Request;
  use Illuminate\Http\Resources\Json\JsonResource;

  class ProductResource extends JsonResource
  {
      public function toArray(Request $request): array
      {
          return [
              'id' => $this->id,
              'name' => $this->name,
              'description' => $this->description,
              'price' => (float) $this->price, // Приведение к float для консистентности
              'isActive' => (bool) $this->is_active, // Именование в camelCase для JSON
              'category' => CategoryResource::make($this->whenLoaded('category')), // Использование ::make()
              'createdAt' => $this->created_at?->toIso8601String(), // Безопасный вызов
              'updatedAt' => $this->updated_at?->toIso8601String(),
          ];
      }
  }
  ```</code><button class="copy-btn">Копировать</button></pre>
            </div>

            <div class="collapsible-header">
                <span>Пример: `pest-testing-guidelines.mdc` (Правила для PestPHP тестов)</span>
                <span class="arrow">▼</span>
            </div>
            <div class="collapsible-content">
                    <pre><code class="language-yaml">---
description: "Руководство по генерации PestPHP тестов для новых функций. Применяется при запросе на написание тестов."
alwaysApply: false
globs: ["tests/Feature/**/*.php", "tests/Unit/**/*.php"] # Может быть Auto Attached для файлов тестов
tags: ["laravel", "testing", "pestphp"]
---
# Руководство по генерации PestPHP тестов
- Генерируйте тесты PestPHP для всех новых публичных методов в контроллерах, сервисах и actions.
- Feature тесты (`tests/Feature/`) должны проверять HTTP эндпоинты, включая статусы ответа, структуру JSON (для API), редиректы, проверку данных в БД.
- Unit тесты (`tests/Unit/`) должны проверять отдельные компоненты (сервисы, actions, кастомные классы) в изоляции, мокая зависимости.
- Убедитесь, что тесты покрывают основные сценарии использования ("happy path") и пограничные случаи (ошибки валидации, неавторизованный доступ, исключения).
- Используйте датасеты Pest (`with()`) для параметризации тестов, где это уместно.
- Предпочитайте `expect()` для утверждений.
- Используйте фабрики моделей (`YourModel::factory()->create()`) для создания тестовых данных.
- Очищайте состояние после тестов, если это необходимо (например, используя трейт `RefreshDatabase`).
- Названия тестов должны быть описательными, используя `it()` или `test()`.
- Пример структуры feature теста для Laravel 11/12:
  ```php
  use function Pest\Laravel\{getJson, postJson, actingAs}; // Импорт actingAs
  use App\Models\{User, Product}; // Групповой импорт
  use Illuminate\Foundation\Testing\RefreshDatabase;

  uses(RefreshDatabase::class);

  it('allows authenticated user to create a product', function () {
      $user = User::factory()->create();
      $productData = Product::factory()->make()->toArray();

      actingAs($user)
          ->postJson(route('api.products.store'), $productData) // Убедитесь, что маршрут 'api.products.store' определен
          ->assertCreated() // Более семантичный ассерт для статуса 201
          ->assertJsonFragment(['name' => $productData['name']]);

      expect(Product::where('name', $productData['name'])->exists())->toBeTrue();
  });
  ```</code><button class="copy-btn">Копировать</button></pre>
                <p class="mt-2">Вы можете найти больше примеров правил на <a href="https://cursor.directory/rules/laravel" target="_blank" class="text-sky-600 hover:underline link-external">Cursor Directory - Laravel Rules</a>.</p>
            </div>

            <div class="collapsible-header">
                <span>Новый Пример: `dto-guidelines.mdc` (Правила для Объектов Передачи Данных - DTO)</span>
                <span class="arrow">▼</span>
            </div>
            <div class="collapsible-content">
                <pre><code class="language-yaml">---
description: "Рекомендации по созданию и использованию Объектов Передачи Данных (DTO) в Laravel проекте."
globs: ["app/DataTransferObjects/**/*.php", "app/DTOs/**/*.php"] # Возможные пути для DTO
alwaysApply: false
tags: ["laravel", "dto", "architecture", "data-handling"]
---
# Руководство по Объектам Передачи Данных (DTO)

- Используйте DTO для структурированной передачи данных между слоями приложения (например, из FormRequest в сервис, из сервиса в событие).
- DTO должны быть простыми, неизменяемыми (immutable) объектами, содержащими только публичные свойства (желательно `readonly` в PHP 8.1+).
- Используйте строгую типизацию для всех свойств DTO.
- Предоставляйте статические фабричные методы для создания DTO из различных источников (например, `fromRequest(Request $request): static`, `fromArray(array $data): static`, `fromModel(Model $model): static`).
- Не размещайте бизнес-логику в DTO. Их единственная задача - хранение и передача данных.
- Рассмотрите использование пакетов, таких как `spatie/laravel-data`, для упрощения создания и работы с DTO.

Пример простого DTO на PHP 8.2+:
```php
namespace App\DataTransferObjects;

use Illuminate\Http\Request;
use App\Models\Product;

readonly class ProductData // PHP 8.2+ readonly class
{
    public function __construct(
        public string $name,
        public ?string $description, // Nullable property
        public float $price,
        public int $categoryId,
        public bool $isActive = true,
        public ?array $tags = null, // Nullable array for tags
    ) {}

    public static function fromRequest(Request $request): static
    {
        return new self(
            name: $request->input('name'),
            description: $request->input('description'),
            price: (float) $request->input('price'),
            categoryId: (int) $request->input('category_id'),
            isActive: (bool) $request->input('is_active', true),
            tags: $request->input('tags'),
        );
    }

    public static function fromModel(Product $product): static
    {
        return new self(
            name: $product->name,
            description: $product->description,
            price: $product->price,
            categoryId: $product->category_id,
            isActive: $product->is_active,
            // tags: $product->tags->pluck('name')->toArray() // Если есть отношение tags
        );
    }

    // Можно добавить метод toArray(), если нужно передать DTO как массив
    public function toArray(): array
    {
        return [
            'name' => $this->name,
            'description' => $this->description,
            'price' => $this->price,
            'category_id' => $this->categoryId,
            'is_active' => $this->isActive,
            'tags' => $this->tags,
        ];
    }
}

// Использование в сервисе:
// public function createProduct(ProductData $productData): Product
// {
//     // ... логика создания продукта на основе $productData
// }
```
Если используется `spatie/laravel-data`, структура DTO будет немного другой, но принципы остаются теми же.
Например, с `spatie/laravel-data`:
```php
// use Spatie\LaravelData\Data;
// use Illuminate\Http\Request;

// class ProductData extends Data
// {
//     public function __construct(
//         public string $name,
//         public ?string $description,
//         public float $price,
//         #[Rule(['required', 'exists:categories,id'])] // Правила валидации можно встраивать
//         public int $category_id,
//         public bool $is_active = true,
//         public ?array $tags = null,
//     ) {}

//     // spatie/laravel-data автоматически предоставляет fromRequest, fromArray и т.д.
// }
```</code><button class="copy-btn">Копировать</button></pre>
            </div>


            <div class="gemini-feature-card">
                <h4>✨ Генератор правил Cursor с помощью AI (Gemini API)</h4>
                <p>Опишите простым языком, какое правило вы хотите создать для своего проекта (например, "Всегда использовать сервисные классы для бизнес-логики в контроллерах" или "Запретить использование dd() и dump() в production коде"). AI предложит вам структуру правила в формате MDC.</p>
                <textarea id="ruleInput" aria-label="Описание правила для генератора правил Cursor" placeholder="Опишите ваше правило здесь... Например: 'Контроллеры должны быть тонкими, использовать Form Requests для валидации и сервисные классы для бизнес-логики. Ответы API должны быть через API Resources.'"></textarea>
                <button id="generateRuleButton" aria-label="Сгенерировать правило MDC с помощью AI">Сгенерировать правило MDC</button>
                <div id="ruleLoader" class="loading-spinner"></div>
                <div id="ruleOutputContainer" style="margin-top: 1rem; display:none;">
                    <h5>Сгенерированное правило:</h5>
                    <pre><code id="ruleOutputMdc"></code><button class="copy-btn" id="copyRuleOutput">Копировать</button></pre>
                    <p class="text-sm text-slate-500 mt-2"><em>Примечание: Это предложение от AI. Внимательно проверьте и адаптируйте его под ваш проект.</em></p>
                </div>
                <div id="ruleError" class="text-red-500 mt-2" style="display: none;"></div>
            </div>
        </section>

        <section id="context-at" class="content-section">
            <h2>4. Управление Контекстом: Заставляем AI Понимать Вашу Кодовую Базу (`@`)</h2>
            <p>Эффективность AI-ассистента Cursor критически зависит от его способности понимать контекст вашего проекта. Символы <code>@</code> в чате, Composer (режим Agent) и при использовании Cmd+K являются ключевым инструментом для управления этим контекстом.</p>

            <h3>4.1. Сила символов `@`</h3>
            <p>Символы <code>@</code> позволяют включать различные части вашего проекта или внешнюю информацию в "поле зрения" AI, делая его ответы и предложения более точными и релевантными. (Актуально на Май 2025)</p>
            <div class="overflow-x-auto">
                <table>
                    <thead>
                    <tr>
                        <th>Символ</th>
                        <th>Описание</th>
                        <th>Пример для Laravel</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td><code>@Files</code> (или <code>#Files</code>)</td>
                        <td>Ссылка на один или несколько конкретных файлов в вашем проекте.</td>
                        <td><code>@Files app/Models/User.php app/Http/Controllers/UserController.php Объясни, как контроллер использует модель User.</code></td>
                    </tr>
                    <tr>
                        <td><code>@Folders</code></td>
                        <td>Ссылка на целые директории для предоставления более широкого контекста. С версии 0.50 может включать все содержимое кодовой базы (требует включения "Full folder contents").</td>
                        <td><code>@Folders app/Services/ Проанализируй сервисы на предмет дублирования логики.</code></td>
                    </tr>
                    <tr>
                        <td><code>@Code</code></td>
                        <td>Ссылка на выделенный в редакторе фрагмент кода или на конкретные символы (функции, классы, методы) из вашей кодовой базы.</td>
                        <td>(Выделить метод в контроллере) В чате: <code>@Code Рефактори этот метод, чтобы он был более читаемым и следовал @controller-guidelines.</code></td>
                    </tr>
                    <tr>
                        <td><code>@Docs</code></td>
                        <td>Доступ к документации и руководствам (встроенным, проектным или добавленным через MCP, например, Context7).</td>
                        <td><code>@Docs:Laravel Как правильно настроить полиморфные отношения 'многие-ко-многим' в Eloquent Laravel 11/12? use context7</code></td>
                    </tr>
                    <tr>
                        <td><code>@Git</code></td>
                        <td>Доступ к истории Git, изменениям. Включает <code>@Commit</code> (изменения с последнего коммита) и <code>@Branch</code> (сравнение с main).</td>
                        <td><code>@Git:@Branch feature-new-payment Какие изменения в этой ветке могут повлиять на модуль аутентификации Laravel Sanctum?</code></td>
                    </tr>
                    <tr>
                        <td><code>@Web</code></td>
                        <td>Ссылка на внешние веб-ресурсы, статьи или документацию по URL для получения актуальной информации.</td>
                        <td><code>@Web https://laravel.com/docs/12.x/routing Объясни основные концепции маршрутизации в Laravel 12.</code> (Замените 12.x на актуальную версию)</td>
                    </tr>
                    <tr>
                        <td><code>@Definitions</code></td>
                        <td>Ссылка на определения классов/функций.</td>
                        <td><code>@Definitions:App\Models\User Опиши все отношения, определенные в этой модели User.</code></td>
                    </tr>
                    <tr>
                        <td><code>@LintErrors</code></td>
                        <td>Ссылка на ошибки линтинга (например, от PHPStan/Psalm, если интегрировано).</td>
                        <td><code>@LintErrors Исправь эти ошибки типизации, обнаруженные PHPStan в текущем файле.</code> (Зависит от интеграции линтера)</td>
                    </tr>
                    <tr>
                        <td><code>@CursorRules</code></td>
                        <td>Ссылка на правила проекта Cursor (<code>.cursor/rules/*.mdc</code>). Имя правила - это имя файла без <code>.mdc</code>.</td>
                        <td><code>@CursorRules:controller-guidelines Убедись, что этот новый контроллер соответствует нашим проектным соглашениям.</code></td>
                    </tr>
                    <tr>
                        <td><code>@Symbols</code></td>
                        <td>Поиск и ссылка на конкретные символы (классы, методы, функции) в кодовой базе.</td>
                        <td><code>@Symbols:ProductService::createProduct Объясни логику этого метода.</code></td>
                    </tr>
                    <tr>
                        <td><code>@Codebase</code></td>
                        <td>Обращение ко всей кодовой базе (используется в Чате c Ctrl+Enter).</td>
                        <td><code>@Codebase Где в проекте используется трейт App\Traits\HasUlid?</code></td>
                    </tr>
                    <tr>
                        <td><code>@Notepads</code></td>
                        <td>Доступ к блокнотам (ранее Projects в Composer).</td>
                        <td><code>@Notepads:api-design-notes Напомни основные решения по дизайну АРІ аутентификации.</code></td>
                    </tr>
                    <tr>
                        <td><code>@PastChats</code></td>
                        <td>Работа с обобщенными сессиями Агента (Composer) или предыдущими чатами.</td>
                        <td><code>@PastChats Вспомни, какой план мы составили для реализации модуля управления заказами.</code></td>
                    </tr>
                    <tr>
                        <td><code>@Recommended</code></td>
                        <td>Автоматически предлагает релевантный контекст (файлы, символы).</td>
                        <td><code>@Recommended Напиши тесты для этой функции. (Cursor сам подберет контекст)</code></td>
                    </tr>
                    </tbody>
                </table>
            </div>

            <h3>4.2. Стратегии предоставления эффективного контекста</h3>
            <ul class="list-disc">
                <li><strong>Будьте конкретны, но не избыточны:</strong> Для точечных задач используйте <code>@Code</code> или <code>@Files</code>. Для более широкого обзора — <code>@Folders</code> или <code>@Codebase</code>.</li>
                <li><strong>Итеративное построение контекста:</strong> Начните с более общего запроса, затем уточняйте, добавляя конкретные файлы или правила.</li>
                <li><strong>Комбинируйте с правилами:</strong> Используйте <code>@CursorRules</code>, чтобы AI следовал стандартам вашего проекта.</li>
                <li><strong>Контекст в режиме Agent:</strong> Agent пытается найти релевантный контекст автоматически, но вы можете (и часто должны) направлять его, предоставляя начальные файлы или папки.</li>
                <li><strong>Проверяйте контекст:</strong> Обращайте внимание, какой контекст фактически использует Cursor (иногда это отображается в интерфейсе AI).</li>
                <li><strong>Четко указывайте версии:</strong> Особенно для Laravel, упоминайте используемую версию (например, Laravel 11, Laravel 12, PHP 8.3), так как API и функции могут меняться.</li>
                <li><strong>Упоминайте ключевые пакеты:</strong> Если задача связана с конкретными пакетами (Spatie, Livewire, Inertia, Filament), укажите это.</li>
            </ul>
            <p>Стратегическое использование @-символов является фундаментальным для преодоления ограничений контекстного окна LLM и эффективного управления Cursor. Освоение "искусства курирования контекста" превращает AI из простого генератора кода в настоящего специалиста по вашему Laravel-проекту.</p>
        </section>

        <section id="ai-assisted-dev" class="content-section">
            <h2>5. AI-Ассистированная Разработка: Промптинг, Режим Агента и Рабочие Процессы</h2>
            <p>Эффективное использование AI в Cursor для разработки на PHP/Laravel требует не только знания команд, но и умения правильно формулировать запросы (промптинг), предоставлять релевантный контекст и понимать, как различные AI-функции (Tab, Cmd+K, Chat, Agent) могут работать в синергии.</p>

            <h3>5.1. Продвинутая Инженерия Промптов для PHP/Laravel</h3>
            <p>Качество ответов AI напрямую зависит от качества ваших промптов.</p>
            <h4>Общие принципы качественного промпта:</h4>
            <ul class="list-disc">
                <li><strong>Конкретность и ясность:</strong> Четко опишите, что вы хотите получить. Вместо "напиши код для юзеров" лучше "создай Eloquent модель User с полями name, email, password и соответствующую миграцию для Laravel 12, используя PHP 8.3".</li>
                <li><strong>Предоставление контекста:</strong> Используйте <code>@</code> символы (<code>@Files app/Models/Post.php</code>, <code>@Folders app/Services/</code>, <code>@CursorRules:coding-standards</code>) для указания релевантных частей проекта.</li>
                <li><strong>Определение желаемого формата вывода:</strong> Например, "Предоставь код для нового метода контроллера", "Перечисли шаги для рефакторинга", "Объясни эту концепцию Laravel".</li>
                <li><strong>Итеративность:</strong> Начните с более общего промпта, затем уточняйте с помощью последующих инструкций. Для сложных задач сначала попросите AI составить план.</li>
                <li><strong>Просьба задавать уточняющие вопросы:</strong> Добавьте в промпт фразу типа "Прежде чем начать, задай мне любые вопросы, которые помогут прояснить эту задачу."</li>
                <li><strong>Разбиение сложных задач:</strong> Большие задачи лучше делить на более мелкие и давать AI по одной.</li>
                <li><strong>Фокус на деталях:</strong> Указывайте версии (Laravel, PHP), используемые пакеты (Spatie, Livewire), желаемый стиль кода (если не покрыто правилами).</li>
            </ul>

            <div class="gemini-feature-card">
                <h4>✨ AI-помощник для создания промптов (Gemini API)</h4>
                <p>Опишите задачу, которую вы хотите поручить AI в Cursor для вашего Laravel проекта (например, "Создать контроллер для управления пользователями с CRUD операциями" или "Написать тесты для сервиса оплаты"). AI поможет вам сформулировать подробный и эффективный промпт.</p>
                <textarea id="promptTaskInput" aria-label="Описание задачи для генератора промптов Cursor" placeholder="Опишите вашу задачу для Laravel здесь... Например: 'Создать API эндпоинты для CRUD операций с моделью Post, используя PostService и PostResource. Включить пагинацию для списка постов.'"></textarea>
                <button id="generatePromptButton" aria-label="Сгенерировать промпт для Cursor с помощью AI">Сгенерировать промпт для Cursor</button>
                <div id="promptLoader" class="loading-spinner"></div>
                <div id="promptOutputContainer" style="margin-top: 1rem; display:none;">
                    <h5>Сгенерированный промпт:</h5>
                    <pre><code id="promptOutputText"></code><button class="copy-btn" id="copyPromptOutput">Копировать</button></pre>
                    <p class="text-sm text-slate-500 mt-2"><em>Примечание: Это предложение от AI. Адаптируйте его под свои нужды и предоставьте необходимый контекст (файлы, правила) в Cursor.</em></p>
                </div>
                <div id="promptError" class="text-red-500 mt-2" style="display: none;"></div>
            </div>

            <h4>Примеры промптов для распространенных Laravel-задач:</h4>
            <div class="collapsible-header">
                <span>Генерация Eloquent моделей, миграций и связей</span>
                <span class="arrow">▼</span>
            </div>
            <div class="collapsible-content">
                <p><strong>Промпт:</strong></p>
                <pre><code>"Создай Eloquent модель 'Product' для Laravel 12 (или 11, если 12 еще не основная) с полями:
- id (ulid, primary)
- name (string, 255, not null)
- slug (string, 255, unique, not null)
- description (text, nullable)
- price (decimal, 10, 2, not null, unsigned)
- stock_quantity (integer, unsigned, default 0)
- is_active (boolean, default true)
Включи типажи HasFactory и SoftDeletes.
Определи следующие отношения:
- `categories()`: многие-ко-многим с моделью `Category` (предположи, что модель `Category` существует или создай ее базовый вариант @app/Models/Category.php). Используй PHPDoc с генериками для PHP 8.3+ (/** @return BelongsToMany<Category> */).
- `reviews()`: один-ко-многим с моделью `Review` (предположи, что модель `Review` существует или создай ее базовый вариант @app/Models/Review.php). (/** @return HasMany<Review> */)
Сгенерируй соответствующий файл миграции.
Убедись, что в модели `$fillable` определен корректно.
Следуй правилам из @eloquent-model-guidelines."</code><button class="copy-btn">Копировать</button></pre>
            </div>

            <div class="collapsible-header">
                <span>Создание Form Request для валидации</span>
                <span class="arrow">▼</span>
            </div>
            <div class="collapsible-content">
                <p><strong>Промпт:</strong></p>
                <pre><code>"Создай Form Request с именем `StoreProductRequest` для Laravel 11/12.
Он должен валидировать следующие поля для создания нового продукта:
- `name`: обязательно, строка, максимум 255 символов.
- `category_id`: обязательно, существует в таблице `categories` в колонке `id`.
- `price`: обязательно, число, минимальное значение 0.01.
- `description`: опционально, строка.
- `tags`: опционально, массив, каждый элемент в массиве должен быть строкой.
Метод `authorize()` должен возвращать `true`.
Убедись, что сообщения об ошибках валидации кастомизированы и удобны для пользователя (на русском языке).
Следуй правилам @form-request-guidelines (если есть такое правило)."</code><button class="copy-btn">Копировать</button></pre>
            </div>

            <div class="collapsible-header">
                <span>Генерация CRUD контроллера с использованием сервисного слоя и DTO</span>
                <span class="arrow">▼</span>
            </div>
            <div class="collapsible-content">
                <p><strong>Промпт:</strong></p>
                <pre><code>"Сгенерируй `ProductController` для Laravel 11/12 с полными CRUD операциями (index, create, store, show, edit, update, destroy) для модели `Product` (@app/Models/Product.php).
Контроллер должен использовать `ProductService` (@app/Services/ProductService.php) для всей бизнес-логики.
Внедряй `ProductService` через конструктор.
Для передачи данных из запроса в сервис используй `ProductData` DTO (@app/DataTransferObjects/ProductData.php). Создай DTO, если его нет, на основе полей модели Product.
Для `store` используй `StoreProductRequest` (@app/Http/Requests/StoreProductRequest.php), который должен наполнять `ProductData` DTO.
Для `update` используй `UpdateProductRequest` (@app/Http/Requests/UpdateProductRequest.php), который также наполняет `ProductData` DTO.
Методы `store`, `update`, `destroy` должны возвращать JSON-ответы, подходящие для API. Используй `ProductResource` (@app/Http/Resources/ProductResource.php) для форматирования ответа.
Метод `index` должен поддерживать пагинацию.
Метод `show` должен использовать явную привязку модели (`Product $product`).
Следуй правилам из @controller-guidelines и @dto-guidelines."</code><button class="copy-btn">Копировать</button></pre>
            </div>

            <div class="collapsible-header">
                <span>Написание PestPHP тестов для контроллера</span>
                <span class="arrow">▼</span>
            </div>
            <div class="collapsible-content">
                <p><strong>Промпт:</strong></p>
                <pre><code>"Напиши PestPHP feature тесты для метода `store` в `ProductController` (@app/Http/Controllers/ProductController.php).
Тесты должны покрывать следующие сценарии:
1. Успешное создание продукта с корректными данными (статус 201/assertCreated, проверка структуры JSON ответа, проверка наличия записи в БД).
2. Ошибка валидации при отсутствии обязательного поля `name` (статус 422, проверка сообщения об ошибке для поля `name`).
3. Ошибка валидации при некорректном `price` (например, отрицательное значение).
Используй фабрику для модели `Product` (@database/factories/ProductFactory.php) для генерации тестовых данных.
Мокай `ProductService` (@app/Services/ProductService.php), чтобы избежать реальных вызовов к сервису, и проверяй, что его метод `createProduct` (или аналогичный) вызывается с правильным DTO (`ProductData`).
Используй трейт `RefreshDatabase`.
Следуй правилам из @pest-testing-guidelines."</code><button class="copy-btn">Копировать</button></pre>
            </div>

            <h3>5.2. Режим Агента (Agent Mode) - Расширенное Руководство</h3>
            <p>Режим Агента (Cmd+I / Ctrl+I) — это наиболее автономный режим в Cursor, предназначенный для выполнения сложных задач от начала до конца с минимальным вмешательством пользователя. Агент исследует кодовую базу, определяет релевантные файлы, планирует изменения и выполняет их, используя все доступные инструменты (поиск, редактирование, создание файлов, запуск команд терминала).</p>
            <h4>Последние Улучшения (Май 2025):</h4>
            <ul class="list-disc">
                <li><strong>Фоновый Режим Агента (Preview):</strong> Агенты могут выполняться в фоновом режиме, позволяя запускать несколько агентов параллельно.</li>
                <li><strong>Улучшенный Контроль Терминала:</strong> Команды, инициированные агентом, можно редактировать перед запуском или пропускать. Опция "Pop-out" переименована в "Move to background".</li>
                <li><strong>Редактирование Правил Агентом:</strong> Агент теперь может надежно редактировать файлы <code>.cursor/rules/*.mdc</code>.</li>
                <li><strong>Эффективное Редактирование Длинных Файлов:</strong> Новый инструмент поиска и замены позволяет агенту изменять только необходимые части длинных файлов.</li>
                <li><strong>Автоматическое Применение Правил:</strong> Для правил <code>Auto Attached</code> агент автоматически применяет нужные правила при чтении или записи файлов.</li>
            </ul>
            <h4>Рабочий Процесс "Scaffold -> Plan -> Execute -> Monitor" для Laravel:</h4>
            <ol class="list-decimal">
                <li><strong>Scaffold (Каркас):</strong> Начать с ручного создания базовых элементов (Artisan, Composer).</li>
                <li><strong>Plan (Планирование):</strong>
                    <ul class="list-disc list-inside ml-2">
                        <li>Сбор полного контекста: Используйте инструменты вроде FileForge или RepoMix для создания снимка проекта.</li>
                        <li>Инструктирование ИИ (например, Gemini 2.5 Pro): Передать этот контекст вместе с четкими инструкциями для генерации пошагового плана.</li>
                    </ul>
                </li>
                <li><strong>Execute (Выполнение):</strong> Скопировать сгенерированный план в новую сессию Агента Cursor с включенным автозапуском.</li>
                <li><strong>Monitor & Nudge (Мониторинг и Корректировка):</strong> Наблюдать за выполнением. Если агент останавливается или ошибается, прервать (Cmd+Shift+Backspace), дать корректирующие инструкции и продолжить.</li>
            </ol>
            <h4>Примеры Задач для Агента в Laravel:</h4>
            <ul class="list-disc">
                <li>"Создай новую фичу Laravel для загрузки аватаров пользователей. Включи: миграцию, обновление модели User, логику в ProfileController, АРІ-маршруты, Form Request, базовые тесты Pest. Используй Spatie MediaLibrary. Убедись, что код соответствует Laravel 11/12 и PHP 8.3+."</li>
                <li>"Рефактори OrderController, чтобы он использовал выделенный класс OrderService для бизнес-логики и OrderData DTO для передачи данных."</li>
                <li>"Проанализируй все контроллеры в папке app/Http/Controllers на предмет N+1 запросов и предложи исправления с использованием eager loading. Примени исправления."</li>
            </ul>
            <p><strong>Режим YOLO (YOLO mode):</strong> Это режим, когда Агент пытается автоматически исправлять ошибки (например, ошибки линтинга или тестов) до тех пор, пока код не заработает или тесты не пройдут. Рекомендуется использовать с осторожностью и частыми коммитами в Git.</p>

            <h3>5.3. Использование различных AI-функций в синергии</h3>
            <p>Эффективная разработка с AI в Cursor часто включает комбинирование его различных функций:</p>
            <ul class="list-disc">
                <li><strong>Agent Mode (Cmd+I / Ctrl+I):</strong> Для комплексных задач, затрагивающих несколько файлов.</li>
                <li><strong>Cmd+K (Встроенное редактирование/генерация):</strong> Для точечной генерации или рефакторинга кода внутри одного файла.</li>
                <li><strong>Chat (Cmd+L / Ctrl+L):</strong> Для обсуждения кода, получения объяснений, отладки ошибок, генерации идей или планирования.</li>
                <li><strong>Автодополнение Tab:</strong> Постоянно используется для ускорения написания кода.</li>
            </ul>
        </section>

        <section id="advanced-php-laravel" class="content-section">
            <h2>6. Продвинутая PHP/Laravel Разработка с Помощью AI</h2>
            <p>Этот раздел посвящен углубленному использованию Cursor для специфических задач разработки на PHP и Laravel, включая работу с актуальными версиями, статический анализ, тестирование и особенности фреймворка.</p>

            <h3>6.1. Актуальные Версии PHP и Laravel (PHP 8.2/8.3/8.4, Laravel 11/12)</h3>
            <p>Убедитесь, что все примеры и конфигурации совместимы с PHP 8.2+ (рекомендуется PHP 8.3 или даже 8.4, если он стабилен к Маю 2025) и Laravel 11/12. Laravel 11 уже принес оптимизацию структуры и другие улучшения. Laravel 12, вероятно, продолжит эту тенденцию, возможно, с новыми возможностями в области маршрутизации ("Precise Routing"), конфигурации или асинхронности.</p>
            <p><strong>Пример промпта для AI:</strong> "Обнови этот код контроллера Laravel 10 для совместимости с Laravel 12, учитывая новую структуру конфигурации (если применимо в L12) и автоматическую регистрацию команд. Используй синтаксис PHP 8.3."</p>

            <h4>Пример использования PHP 8.3 `#[Override]` атрибута в Laravel:</h4>
            <p>Атрибут `#[Override]` (доступен с PHP 8.3) помогает статически убедиться, что метод действительно переопределяет родительский метод или реализует метод интерфейса. Это предотвращает ошибки, если сигнатура родительского метода изменяется или если вы ошиблись в имени метода.</p>
            <pre><code class="language-php">namespace App\Services;

use App\Contracts\PaymentGateway;
use Illuminate\Support\Facades\Log;

class StripePaymentService implements PaymentGateway
{
    #[\Override] // Указывает, что мы намеренно реализуем метод из PaymentGateway
    public function processPayment(float $amount, string $currency): bool
    {
        Log::info("Processing payment of {$amount} {$currency} via Stripe.");
        // ... логика взаимодействия со Stripe API ...
        return true; // Упрощенный пример
    }

    #[\Override]
    public function refundPayment(string $transactionId, float $amount): bool
    {
        Log::info("Refunding payment {$transactionId} for amount {$amount} via Stripe.");
        // ... логика возврата ...
        return true;
    }
}

// Предполагаемый интерфейс App\Contracts\PaymentGateway:
// interface PaymentGateway
// {
//     public function processPayment(float $amount, string $currency): bool;
//     public function refundPayment(string $transactionId, float $amount): bool;
// }
</code><button class="copy-btn">Копировать</button></pre>
            <p>Если бы в интерфейсе `PaymentGateway` метод `processPayment` был переименован или его сигнатура изменилась, PHP выдал бы ошибку компиляции благодаря атрибуту `#[Override]` в `StripePaymentService`.</p>
            <p>Аналогично, если бы Laravel 12 ввел новый базовый класс для контроллеров с методом, который вы хотите переопределить, `#[Override]` помог бы обеспечить корректность.</p>


            <h3>6.2. Интеграция Статического Анализа (PHPStan и Psalm)</h3>
            <p>Эти инструменты критически важны для надежной разработки на РНР. Cursor может помочь в их интеграции и интерпретации результатов.</p>
            <div class="collapsible-header">
                <span>6.2.1. PHPStan (с Larastan)</span>
                <span class="arrow">▼</span>
            </div>
            <div class="collapsible-content">
                <p>PHPStan фокусируется на поиске ошибок в коде без его фактического выполнения.</p>
                <ul class="list-disc">
                    <li><strong>Установка:</strong> <code>composer require --dev phpstan/phpstan nunomaduro/larastan</code></li>
                    <li><strong>Конфигурация:</strong> Создайте <code>phpstan.neon</code> (или <code>phpstan.neon.dist</code>).
                        <pre><code class="language-yaml"># phpstan.neon
parameters:
    paths:
        - app
        - routes
        - config
        # - tests # Раскомментируйте, если хотите анализировать тесты
    level: 6 # Рекомендуется начать с 5-6 и постепенно повышать до 8-9 (max)
    ignoreErrors:
        # - '#PHPDoc tag @var with type Illuminate\\Database\\Eloquent\\Collection|App\\Models\\User\[\] is not subtype of generic type Illuminate\\Database\\Eloquent\\Collection<App\\Models\\User> of property App\\Models\\Post::\$users.#'
        # - '#Call to an undefined method Illuminate\\Database\\Eloquent\\Builder::[a-zA-Z0-9_]+\(\).#' # Для кастомных макросов Query Builder
    checkMissingIterableValueType: false
    checkGenericClassInNonGenericObjectType: false
    treatPhpDocTypesAsCertain: false # Установите true для более строгой проверки PHPDoc
    reportUnmatchedIgnoredErrors: false # Установите true, чтобы видеть, какие ignoreErrors больше не нужны

includes:
    - ./vendor/nunomaduro/larastan/extension.neon
    # - phpstan-baseline.neon # Если используете baseline для постепенного внедрения

# Для PHP 8.3+ можно добавить:
#    phpVersion: 80300 # Указывает версию PHP для анализа (например, 80300 для 8.3)

# Larastan специфичные настройки:
#    larastan:
#        analyseModels: true
#        analyseMigrations: true
#        databasePath: database/database.sqlite # Если используется SQLite для тестов/анализа
</code><button class="copy-btn">Копировать</button></pre>
                    </li>
                    <li><strong>Запуск анализа:</strong> <code>./vendor/bin/phpstan analyse</code></li>
                    <li><strong>Помощь Cursor:</strong>
                        <ul>
                            <li>Генерация/обновление конфигурации <code>phpstan.neon</code>.</li>
                            <li>Интерпретация ошибок PHPStan и предложение исправлений (<code>@LintErrors Помоги исправить эту ошибку PHPStan: [текст ошибки]</code>).</li>
                            <li>Интеграция правил PHPStan в <code>.cursor/rules</code> для обеспечения типобезопасности.</li>
                        </ul>
                    </li>
                    <li>Не забывайте про <code>barryvdh/laravel-ide-helper</code> для лучшего понимания "магии" Laravel статическими анализаторами.</li>
                </ul>
            </div>
            <div class="collapsible-header">
                <span>6.2.2. Psalm</span>
                <span class="arrow">▼</span>
            </div>
            <div class="collapsible-content">
                <p>Psalm также является мощным статическим анализатором, способным обнаруживать уязвимости безопасности.</p>
                <ul class="list-disc">
                    <li><strong>Установка:</strong> <code>composer require --dev vimeo/psalm</code></li>
                    <li><strong>Инициализация:</strong> <code>./vendor/bin/psalm --init</code> (создаст <code>psalm.xml</code>). Можно указать уровень строгости.</li>
                    <li><strong>Плагин для Laravel:</strong> <code>composer require --dev psalm/plugin-laravel</code> и регистрация в <code>psalm.xml</code>: <code><plugins><pluginClass class="Psalm\LaravelPlugin\Plugin"/></plugins></code>.</li>
                    <li><strong>Запуск анализа:</strong> <code>./vendor/bin/psalm</code></li>
                    <li><strong>Помощь Cursor:</strong> Аналогично PHPStan – генерация конфигурации, интерпретация ошибок, предложение исправлений.</li>
                </ul>
            </div>
            <p>Использование статического анализа обеспечивает объективный контроль качества кода, генерируемого ИИ, создавая цикл обратной связи.</p>

            <h3>6.3. Стратегии Тестирования с Помощью ИИ (PestPHP и PHPUnit)</h3>
            <p>Cursor может значительно ускорить написание тестов.</p>
            <ul class="list-disc">
                <li><strong>Генерация Unit-тестов:</strong> "Сгенерируй тесты PestPHP для всех публичных методов в классе <code>App\Services\PaymentService</code>, замокай вызовы внешних АРІ. Используй дата-провайдеры Pest для различных сценариев."</li>
                <li><strong>Генерация Feature-тестов:</strong> "Напиши feature-тест PestPHP для <code>ProductController@store</code>. Проверь успешное создание продукта (assert database has record, assert redirect/assertCreated) и ошибку валидации (assert session has errors for specific fields / assertInvalid). Учти аутентификацию и авторизацию."</li>
                <li><strong>Использование ИИ для генерации тестовых данных</strong> с помощью фабрик моделей и состояний фабрик.</li>
                <li><strong>Использование ИИ для понимания и исправления неработающих тестов.</strong> "Этот тест Pest падает с ошибкой [текст ошибки]. Объясни причину и предложи исправление. @Files tests/Feature/MyTest.php"</li>
                <li><strong>Включение требований к тестированию в <code>.cursor/rules</code></strong> (например, "Всегда генерируй тесты Pest для новых действий контроллера, покрывая как минимум happy path и один случай ошибки валидации").</li>
            </ul>
            <p>Тесты, сгенерированные ИИ, требуют тщательного обзора, так как они могут упускать крайние случаи или не полностью отражать бизнес-логику.</p>

            <h3>6.4. Помощь ИИ для Шаблонов Blade и Eloquent ORM</h3>
            <h4>Blade:</h4>
            <ul class="list-disc">
                <li>Генерация компонентов Blade, включая те, что с свойствами и именованными слотами: "Создай компонент Laravel Blade <code>alert</code> со свойствами <code>type</code> (string, default 'info') и <code>message</code> (string), и именованными слотами <code>title</code> и <code>footer</code>. Используй классы Tailwind CSS для стилизации в зависимости от типа (info, success, warning, danger)."</li>
                <li>Рефакторинг сложных представлений Blade в переиспользуемые компоненты.</li>
                <li>Помощь с директивами Blade и управляющими структурами, включая новые возможности в Laravel 11/12.</li>
            </ul>
            <h4>Eloquent ORM:</h4>
            <ul class="list-disc">
                <li>Генерация моделей Eloquent с отношениями: "Сгенерируй модель Eloquent <code>Order</code> с отношением <code>belongsTo</code> к <code>User</code> и <code>hasMany</code> к <code>OrderItem</code>. Добавь PHPDoc с генериками для отношений (PHP 8.3+)."</li>
                <li>Написание сложных запросов Eloquent, включая соединения, подзапросы и агрегации. "Напиши запрос Eloquent для получения пользователей, у которых более 5 заказов за последний месяц, с eager loading их последних 3 заказов."</li>
                <li>Оптимизация запросов Eloquent (выявление N+1, предложение eager loading, использование `select()` для выбора только нужных колонок).</li>
                <li>Генерация API Resources для моделей Eloquent, следуя лучшим практикам (см. `api-resource-guidelines.mdc`).</li>
                <li>Генерация Form Requests для валидации данных перед операциями Eloquent.</li>
            </ul>
            <p>Для специфичных функций фреймворка, таких как Blade и Eloquent, эффективность ИИ зависит от его обучающих данных и предоставленного контекста. Четкие промпты, указывающие на соглашения Laravel, имеют решающее значение.</p>
        </section>

        <section id="mcp-servers" class="content-section">
            <h2>7. Расширение Cursor с помощью MCP-серверов (Model Context Protocol)</h2>
            <p>Model Context Protocol (MCP) стандартизирует взаимодействие AI-приложений с внешними источниками данных и инструментами. MCP-серверы расширяют возможности Cursor, позволяя AI подключаться к базам данных, API, актуальной документации, выполнять команды и многое другое, что особенно ценно для Laravel-разработки. Экосистема MCP все еще относительно нова (Май 2025), но быстро развивается.</p>

            <h3>7.1. Что такое MCP-серверы и их значение для Laravel</h3>
            <p>MCP-серверы позволяют AI в Cursor:</p>
            <ul class="list-disc">
                <li>Взаимодействовать с внешними системами (Artisan, логи, внешние API).</li>
                <li>Использовать актуальную, версионную документацию (например, через Context7).</li>
                <li>Создавать "общую память" между различными AI-инструментами (OpenMemory MCP).</li>
            </ul>
            <p>LLM сами по себе не знают, как выполнять <code>php artisan</code> или анализировать специфический формат логов. МСР предоставляют стандартизированный протокол для определения "инструментов", которые ИИ может вызывать.</p>

            <h3>7.2. Комплексная Настройка и Конфигурация МСР</h3>
            <p>MCP-серверы настраиваются через JSON-файлы:</p>
            <ul class="list-disc">
                <li><strong>Специфичные для проекта:</strong> <code>.cursor/mcp.json</code>.</li>
                <li><strong>Глобальные:</strong> <code>~/.cursor/mcp.json</code> (в домашней директории пользователя).</li>
            </ul>
            <p>Структура <code>mcp.json</code>:</p>
            <pre><code class="language-json">{
  "mcpServers": {
    "имя-вашего-сервера": {
      "command": "путь/к/команде/или/скрипту", // Для stdio транспорта
      // "url": "http://localhost:port/path", // Для SSE транспорта
      "args": ["аргумент1", "аргумент2"],
      "env": { "API_KEY_FOR_MCP": "ваш_api_ключ_для_этого_mcp" },
      "cwd": "${workspaceFolder}" // Рабочая директория
    }
    // ... другие серверы
  }
}</code><button class="copy-btn">Копировать</button></pre>
            <p><strong>Типы Транспорта:</strong> <code>stdio</code> (локальный, управляется Cursor) vs. <code>SSE</code> (Server-Sent Events; локальный/удаленный, управляется пользователем).</p>
            <p><strong>Последние Обновления (Май 2025):</strong> Запуск stdio из удаленной рабочей области (WSL, Remote SSH), поддержка потокового НТТР, исправление утечек SSE-соединений, более надежное обновление конфигурации, изображения в контексте МСР, отключение отдельных инструментов МСР.</p>
            <p><strong>Известные Ограничения:</strong> Ограничение на количество инструментов, проблемы с удаленной разработкой, поддержка ресурсов.</p>

            <h3>7.3. Ключевые MCP-серверы для PHP/Laravel</h3>

            <div class="collapsible-header">
                <span>7.3.1. Context7: Актуальная документация</span>
                <span class="arrow">▼</span>
            </div>
            <div class="collapsible-content">
                <p>Context7 предоставляет AI доступ к свежей, версионной документации (включая Laravel), уменьшая "галлюцинации".</p>
                <p><strong>Настройка (пример для <code>~/.cursor/mcp.json</code>):</strong></p>
                <pre><code class="language-json">{
  "mcpServers": {
    "context7": {
      "command": "npx",
      "args": ["-y", "@upstash/context7-mcp@latest"],
      "env": {
        // "SMITHERY_API_KEY": "ВАШ_SMITHERY_API_KEY_ЕСЛИ_НУЖЕН_ДЛЯ_УСТАНОВКИ_ЧЕРЕЗ_SMITHERY"
        // Для публичной документации обычно ключ не требуется.
      }
    }
  }
}</code><button class="copy-btn">Копировать</button></pre>
                <p><strong>Требование:</strong> Node.js v18.0+.</p>
                <p><strong>Использование:</strong> <code>"Как настроить трансляцию событий в Laravel 12? use context7"</code>.</p>
            </div>

            <div class="collapsible-header">
                <span>7.3.2. jsonallen/laravel-mcp (Laravel Helper Tools)</span>
                <span class="arrow">▼</span>
            </div>
            <div class="collapsible-content">
                <p>MCP-сервер для улучшения разработки Laravel. Предоставляет инструменты, такие как <code>tail_log_file</code>, <code>search_log_errors</code>, <code>run_artisan_command</code>, <code>show_model</code>.</p>
                <p><strong>Статус:</strong> Альфа/Бета-версия ПО (на момент Май 2025). Следите за обновлениями в репозитории.</p>
                <p><strong>Настройка:</strong> Требует клонирования репозитория с GitHub, создания shell-скрипта обертки, настройки Python окружения. Требования: РHP 8.1+, Laravel 10.0+, Cursor, UV (инструменты для упаковки Python).</p>
                <p><strong>Примеры Промптов:</strong> <code>"@LaravelHelperTools run artisan migrate"</code>, <code>"@LaravelHelperTools покажи мне последние 50 строк лога ошибок."</code></p>
                <div class="alert-warning"><p>Так как пакет может находиться в стадии активной разработки, следите за его репозиторием для актуальной информации по установке и использованию.</p></div>
            </div>

            <div class="collapsible-header">
                <span>7.3.3. php-mcp/laravel: Ваше Laravel-приложение как MCP-сервер</span>
                <span class="arrow">▼</span>
            </div>
            <div class="collapsible-content">
                <p>Библиотека <code>php-mcp/laravel</code> позволяет вашему Laravel-приложению выступать в роли MCP-сервера, создавая кастомные инструменты с использованием РНР-атрибутов. Предоставляет команду <code>php artisan make:mcp-tool</code>.</p>
                <p><strong>Статус:</strong> К Маю 2025 года, вероятно, достигнет большей стабильности и будет иметь более широкое распространение.</p>
                <p><strong>Настройка:</strong> <code>composer require php-mcp/laravel</code>, публикация конфигурации (<code>config/mcp.php</code>). Критически важно исключение CSRF для HTTТР-транспорта.</p>
                <p><strong>Определение Инструментов:</strong> Декорирование методов/вызываемых классов атрибутами <code>#[McpTool]</code>, <code>#[McpResource]</code>, <code>#[McpPrompt]</code> в настроенных директориях обнаружения (например, <code>app/Mcp</code>).</p>
                <p><strong>Запуск:</strong> <code>php artisan mcp:serve</code> для stdio, или настройка веб-сервера (Nginx+FPM, Octane) для НТТP+SSE.</p>
                <p>Пример конфигурации клиента для stdio в <code>.cursor/mcp.json</code>:</p>
                <pre><code class="language-json">{
  "mcpServers": {
    "my-laravel-mcp": {
      "command": "php",
      "args": [
        "${workspaceFolder}/artisan", // Используем ${workspaceFolder} для гибкости
        "mcp:serve"
      ],
      "cwd": "${workspaceFolder}"
    }
  }
}</code><button class="copy-btn">Копировать</button></pre>
            </div>

            <div class="collapsible-header">
                <span>7.3.4. usecroft/croft-laravel: Еще один MCP-сервер для Laravel</span>
                <span class="arrow">▼</span>
            </div>
            <div class="collapsible-content">
                <p>Croft также является MCP-сервером, ориентированным на Laravel. Устанавливается в проект (<code>composer require usecroft/croft-laravel --dev</code>) и добавляет команду <code>artisan croft</code>. Предоставляет утилиты для получения информации о проекте (скриншот URL, документация InertiaJS, запросы к БД, структура БД, список маршрутов/Artisan-команд и т.д.).</p>
                <p><strong>Статус:</strong> Проверьте репозиторий на актуальность к Маю 2025.</p>
                <p><strong>Конфигурация Cursor:</strong> <code>.cursor/mcp.json</code> с командой <code>./artisan croft</code>.</p>
                <p><strong>Пользовательские Инструменты:</strong> Можно расширить <code>Croft\Feature\Tool\AbstractTool</code>.</p>
            </div>

            <div class="collapsible-header">
                <span>7.3.5. OpenMemory MCP (mem0.ai): Общая память для AI</span>
                <span class="arrow">▼</span>
            </div>
            <div class="collapsible-content">
                <p>OpenMemory — это локальный, приватный уровень памяти для инструментов ИИ, обеспечивающий общий контекст между приложениями (Cursor, Claude и др.).</p>
                <p><strong>Настройка для Cursor:</strong> Требуется Docker, OpenAI API Key (для некоторых функций mem0). Запустить скрипт установки с GitHub <code>mem0ai/mem0</code>. Настроить в МСР-настройках Cursor (тип SSE, эндпоинт <code>http://0.0.0.0:8080/sse</code> или согласно документации mem0).</p>
                <p><strong>Функции:</strong> <code>add_memories</code>, <code>search_memory</code>, <code>list_memories</code>, <code>delete_all_memories</code>.</p>
                <p><strong>Последние Обновления (Май 2025):</strong> К этому времени ожидается более зрелая версия с улучшенной стабильностью и возможно, новыми функциями.</p>
                <p>Это позволяет AI-инструментам запоминать ваш стиль, прошлые вопросы и контекст проекта, повышая релевантностью ответов.</p>
            </div>
            <div class="collapsible-header">
                <span>7.3.6. Обзор Других Полезных МСР-Серверов</span>
                <span class="arrow">▼</span>
            </div>
            <div class="collapsible-content">
                <p>Кратко упомянуть другие МСР из Cursor Directory или сообщества, которые могут быть релевантны:</p>
                <ul class="list-disc">
                    <li>GitHub МСР для отслеживания задач.</li>
                    <li>МСР для баз данных (например, для выполнения SQL-запросов или просмотра схемы).</li>
                    <li>Firecrawl для веб-скрейпинга.</li>
                    <li>Browserbase для автоматизации браузера.</li>
                    <li>Ragic МСР для Google Drive, Jira, Slack.</li>
                </ul>
                <p class="mt-4">Вы можете найти другие MCP-серверы и информацию о них на <a href="https://cursor.directory/mcp" target="_blank" class="text-sky-600 hover:underline link-external">Cursor Directory - MCP Servers</a>.</p>
            </div>
            <p>Разработчики Laravel могут значительно выиграть от использования как МСР общего назначения, так и специфичных для фреймворка. Руководство должно дать пользователям возможность не только использовать существующие МСР, но и понимать, как они потенциально могут создавать свои собственные.</p>
        </section>

        <section id="debugging" class="content-section">
            <h2>8. Отладка PHP и Laravel Приложений в Cursor с Xdebug</h2>
            <p>Отладка — неотъемлемая часть разработки. Cursor предлагает как AI-ассистированные подходы, так и традиционные методы с использованием Xdebug. Эти подходы дополняют друг друга.</p>

            <h3>8.1. Использование AI Cursor для отладки</h3>
            <ul class="list-disc">
                <li><strong>Режим Agent:</strong> Может обнаруживать ошибки линтинга и автоматически применять исправления.</li>
                <li><strong>Чат (Cmd+L / Ctrl+L):</strong> Задайте вопрос "Есть ли здесь ошибка?" или попросите AI объяснить сообщение об ошибке Laravel (вставьте стектрейс). Пример: <code>"Объясни это исключение Laravel и предложи возможные причины и решения. Это произошло в проекте Laravel 12 на РНР 8.3. @Files path/to/ErrorClass.php [стектрейс]"</code></li>
                <li><strong>Cmd+K/Ctrl+K:</strong> Выделите ошибочный код и попросите AI исправить его или добавить отладочные операторы (например, <code>Log::info()</code>). Пример: <code>"Добавь Log::debug() для отслеживания значений переменных \$variableA и \$variableB в этой функции."</code></li>
            </ul>

            <h3>8.2. Традиционная отладка с Xdebug</h3>
            <p>Для глубокой отладки PHP-кода Cursor, как и VS Code, полагается на Xdebug. Основная сложность заключается в начальной настройке.</p>

            <div class="collapsible-header">
                <span>8.2.1. Установка Xdebug и конфигурация PHP</span>
                <span class="arrow">▼</span>
            </div>
            <div class="collapsible-content">
                <p><strong>Установка расширения Xdebug:</strong></p>
                <ul class="list-disc">
                    <li>Используйте PECL (<code>pecl install xdebug</code>), Homebrew (<code>brew install phpXX-xdebug</code> для macOS), менеджеры пакетов Linux (<code>sudo apt install phpX.Y-xdebug</code>) или загрузите DLL для Windows с <a href="https://xdebug.org/wizard" target="_blank" class="text-sky-600 hover:underline link-external">Xdebug Wizard</a>.</li>
                </ul>
                <p><strong>Конфигурация <code>php.ini</code>:</strong></p>
                <p>Найдите ваш <code>php.ini</code> (<code>php --ini</code> или <code>phpinfo()</code>). Добавьте/измените (для Xdebug 3.x рекомендуется):</p>
                <pre><code class="language-ini">zend_extension=xdebug ; Путь может быть полным, например zend_extension=/usr/lib/php/20220829/xdebug.so (для PHP 8.2) или /usr/lib/php/20230831/xdebug.so (для PHP 8.3)
xdebug.mode=debug
xdebug.start_with_request=yes ; 'yes' - всегда активен, 'trigger' - активируется по триггеру (куки, GET/POST параметр)
xdebug.client_host=127.0.0.1   ; Для Docker/Sail используйте 'host.docker.internal' или IP хоста
xdebug.client_port=9003       ; Стандартный порт для Xdebug 3
; xdebug.log="/tmp/xdebug.log" ; Опционально, для логов Xdebug (убедитесь, что у PHP есть права на запись)
; xdebug.discover_client_host=false ; Обычно false, если client_host указан явно
; xdebug.idekey="CURSOR_IDE" ; Иногда полезно для идентификации IDE, если start_with_request=trigger
; xdebug.output_dir = "/tmp/xdebug_traces" ; Для профилирования или трассировки
; xdebug.file_link_format = "cursor://open?file=%f&line=%l" ; Для прямого открытия файлов в Cursor из вывода Xdebug (если поддерживается)
</code><button class="copy-btn">Копировать</button></pre>
                <p><strong>Перезагрузка веб-сервера:</strong> Apache/Nginx и PHP-FPM (если используется).</p>
                <p><strong>Проверка:</strong> Создайте файл с <code>&lt;?php phpinfo(); ?&gt;</code> и убедитесь, что секция Xdebug присутствует и активна.</p>
            </div>

            <div class="collapsible-header">
                <span>8.2.2. Конфигурация `launch.json` в Cursor для Xdebug</span>
                <span class="arrow">▼</span>
            </div>
            <div class="collapsible-content">
                <p>Убедитесь, что установлено расширение "PHP Debug" (от Xdebug Team).</p>
                <p>В проекте перейдите на вкладку "Run and Debug" (значок жука), нажмите на значок шестеренки и выберите "PHP". Это создаст/откроет <code>.vscode/launch.json</code>.</p>
                <p><strong>Основная конфигурация "Listen for Xdebug":</strong></p>
                <pre><code class="language-json">{
    "version": "0.2.0",
    "configurations": [
        {
            "name": "Listen for Xdebug",
            "type": "php",
            "request": "launch",
            "port": 9003, // Должен совпадать с xdebug.client_port
            "pathMappings": {
                // КРИТИЧЕСКИ ВАЖНО для Docker/Sail/VM
                // Пример для Laravel Sail (если корень проекта в /var/www/html внутри контейнера):
                "/var/www/html": "${workspaceFolder}"
                // Ключ - это АБСОЛЮТНЫЙ путь ВНУТРИ контейнера/VM к корню проекта
                // Значение - это АБСОЛЮТНЫЙ путь к корню проекта на ВАШЕЙ машине (${workspaceFolder})
            },
            "log": false, // Установите true для просмотра логов соединения Xdebug в консоли отладки Cursor
            "ignore": [ // Опционально: игнорировать файлы/папки при отладке
                "**/vendor/**/*.php"
            ],
            "skipFiles": [ // Аналогично ignore, но для "Step Into"
                "${workspaceFolder}/vendor/**/*.php"
            ]
        },
        {
            "name": "Launch currently open script (CLI)", // Для отладки CLI скриптов
            "type": "php",
            "request": "launch",
            "program": "${file}", // Отлаживаемый файл
            "cwd": "${fileDirname}", // Рабочая директория
            "port": 9003,
            "runtimeArgs": [ // Аргументы для PHP CLI, если нужны
                "-dxdebug.start_with_request=yes"
            ],
            "pathMappings": {
                // Аналогично, если скрипт запускается в Docker/VM
                // "/var/www/html": "${workspaceFolder}"
            }
        },
        {
            "name": "Launch Built-in web server", // Если используете встроенный сервер PHP
            "type": "php",
            "request": "launch",
            "runtimeArgs": [
                "-dxdebug.mode=debug",
                "-dxdebug.start_with_request=yes",
                "-S",
                "localhost:8000", // или другой порт
                "-t",
                "${workspaceFolder}/public" // Корневая директория для Laravel
            ],
            "program": "",
            "cwd": "${workspaceFolder}",
            "port": 9003,
            "serverReadyAction": {
                "pattern": "Development Server \\(http://localhost:([0-9]+)\\) started",
                "uriFormat": "http://localhost:%s",
                "action": "openExternally"
            }
        }
    ]
}</code><button class="copy-btn">Копировать</button></pre>
                <p><strong><code>pathMappings</code>:</strong> Сопоставляет пути на сервере/в контейнере с путями в локальной рабочей области. Без правильного <code>pathMappings</code> отладчик не сможет найти исходные файлы при работе с Docker (Laravel Sail), Vagrant или удаленными серверами.</p>
            </div>

            <div class="collapsible-header">
                <span>8.2.3. Отладка в средах Laravel Sail и Herd</span>
                <span class="arrow">▼</span>
            </div>
            <div class="collapsible-content">
                <h4>Laravel Sail и Xdebug:</h4>
                <ul class="list-disc">
                    <li>Sail работает в Docker, поэтому <code>xdebug.client_host</code> в <code>php.ini</code> контейнера должен быть <code>host.docker.internal</code> (для Docker Desktop) или IP-адрес хоста.</li>
                    <li>Laravel Sail предоставляет переменные окружения для управления Xdebug, такие как <code>SAIL_XDEBUG_MODE</code> и <code>SAIL_XDEBUG_CONFIG</code> в вашем файле <code>.env</code>. Пример:
                        <pre><code class="language-text">SAIL_XDEBUG_MODE=debug
SAIL_XDEBUG_CONFIG="client_host=host.docker.internal client_port=9003"</code><button class="copy-btn">Копировать</button></pre>
                    </li>
                    <li>Критически важны <code>pathMappings</code> в <code>launch.json</code> (например, <code>"/var/www/html": "${workspaceFolder}"</code>).</li>
                    <li>Для отладки Artisan-команд и тестов внутри Sail, если <code>xdebug.start_with_request=trigger</code>, может потребоваться установка переменной окружения <code>XDEBUG_SESSION=CURSOR_IDE</code> (или другое значение <code>idekey</code>) перед запуском команды: <code>sail artisan tinker -e XDEBUG_SESSION=CURSOR_IDE</code>. Или установить <code>xdebug.start_with_request=yes</code> для CLI в конфигурации PHP контейнера.</li>
                </ul>
                <h4>Laravel Herd и Xdebug:</h4>
                <ul class="list-disc">
                    <li>Herd часто упрощает настройку Xdebug, так как распознает Cursor как одну из поддерживаемых IDE.</li>
                    <li>Проверьте конфигурацию PHP в Herd на предмет настроек Xdebug. Обычно Herd настраивает Xdebug автоматически.</li>
                    <li>Конфигурация <code>launch.json</code> для проектов Herd обычно не требует сложных <code>pathMappings</code>, так как Herd работает нативно.</li>
                </ul>
                <p><strong>Использование ИИ Cursor для Отладки:</strong> Как ИИ может помочь интерпретировать сессии Xdebug, объяснять состояния переменных или предлагать следующие шаги, если возникли трудности.</p>
            </div>

            <div class="collapsible-header">
                <span>8.2.4. Процесс отладки и распространенные проблемы</span>
                <span class="arrow">▼</span>
            </div>
            <div class="collapsible-content">
                <ul class="list-disc">
                    <li><strong>Установка точек останова (breakpoints):</strong> Кликните на полях слева от номеров строк (или F9).</li>
                    <li><strong>Запуск отладки:</strong> F5 или выберите конфигурацию "Listen for Xdebug" на панели "Run and Debug" и нажмите "Play". Затем откройте страницу в браузере (или используйте расширение браузера для Xdebug, чтобы инициировать сессию, если <code>start_with_request=trigger</code>).</li>
                    <li><strong>Управление выполнением:</strong> F5 (Continue), F10 (Step Over), F11 (Step Into), Shift+F11 (Step Out).</li>
                    <li><strong>Инспекция переменных и стека вызовов:</strong> На панелях "Variables" и "Call Stack".</li>
                </ul>
                <h5>Распространенные проблемы при настройке Xdebug:</h5>
                <ul class="list-disc">
                    <li><strong>Неправильный порт:</strong> Порт в <code>php.ini</code> (<code>xdebug.client_port</code>) должен совпадать с портом в <code>launch.json</code>.</li>
                    <li><strong>Неправильные <code>pathMappings</code>:</strong> Особенно актуально для Docker/Sail.</li>
                    <li><strong>Брандмауэр/Firewall:</strong> Может блокировать соединение.</li>
                    <li><strong>PHP-FPM/веб-сервер не перезапущен:</strong> Изменения в <code>php.ini</code> требуют перезапуска.</li>
                    <li><strong>Несколько версий PHP:</strong> Убедитесь, что вы редактируете <code>php.ini</code> для той версии PHP, которую использует ваш веб-сервер или CLI.</li>
                    <li><strong>Xdebug не загружен:</strong> Проверьте вывод <code>phpinfo()</code> или <code>php -v</code>.</li>
                    <li><strong>Конфликт с другими расширениями:</strong> Редко, но возможно.</li>
                </ul>
            </div>
        </section>

        <section id="laravel-ecosystem" class="content-section">
            <h2>9. Интеграция с Экосистемой Laravel (Composer, Artisan, Sail/Herd)</h2>
            <p>Cursor эффективно интегрируется с ключевыми инструментами экосистемы Laravel, в основном через встроенный терминал, усиленный AI-возможностями.</p>

            <h3>9.1. Интеграция с Composer</h3>
            <p>Управление зависимостями PHP через Composer осуществляется в терминале Cursor.</p>
            <ul class="list-disc">
                <li><strong>Ручное управление:</strong> <code>composer require vendor/package</code>, <code>composer update</code>, <code>composer install</code>.</li>
                <li><strong>AI-ассистирование (Agent Mode или Cmd+K в терминале):</strong> "Установи пакет spatie/laravel-medialibrary последней стабильной версии (^11.0 или ^12.0 к Маю 2025) и сконфигурируй его сервис-провайдер." Cursor попытается выполнить команду и внести изменения в конфигурационные файлы.</li>
            </ul>

            <h3>9.2. Выполнение команд Artisan</h3>
            <p>Artisan, командная строка Laravel, используется через терминал Cursor.</p>
            <ul class="list-disc">
                <li><strong>Ручное выполнение:</strong> <code>php artisan make:controller MyController</code>, <code>php artisan migrate</code>.</li>
                <li><strong>AI-ассистирование:</strong>
                    <ul>
                        <li><strong>Agent Mode:</strong> "Сгенерируй новую политику для модели Post и зарегистрируй ее в AuthServiceProvider. Убедись, что методы политики соответствуют стандартным CRUD операциям."</li>
                        <li><strong>Cmd+K в терминале:</strong> "создай новую модель Product с миграцией, фабрикой, сидером и контроллером ресурсов" -> AI предложит соответствующие команды Artisan.</li>
                        <li><strong>MCP Серверы:</strong> Некоторые MCP (например, jsonallen/laravel-mcp или php-mcp/laravel) могут предоставлять интерфейс для выполнения Artisan-команд.</li>
                    </ul>
                </li>
            </ul>

            <h3>9.3. Интеграция с Laravel Sail и Herd</h3>
            <p>Инструменты управления окружением, такие как Laravel Sail и Herd, упрощают настройку локальной среды, что положительно сказывается на работе с Cursor, особенно при отладке.</p>
            <div class="collapsible-header">
                <span>9.3.1. Laravel Sail</span>
                <span class="arrow">▼</span>
            </div>
            <div class="collapsible-content">
                <p>Laravel Sail предоставляет легковесную среду разработки Docker.</p>
                <ul class="list-disc">
                    <li><strong>Управление через терминал:</strong> Все команды Sail (<code>./vendor/bin/sail up</code>, <code>./vendor/bin/sail artisan migrate</code>) выполняются в терминале Cursor.</li>
                    <li><strong>Расширение "Laravel Sail" (shreifelagamy):</strong> Рекомендуется установить. Предоставляет панель для управления сервисами Sail, доступа к оболочке контейнера, Tinker, логам. (Проверьте актуальность расширения к Маю 2025).</li>
                    <li><strong>Отладка с Xdebug:</strong> Требует корректной настройки <code>pathMappings</code> в <code>launch.json</code> и конфигурации Xdebug в <code>.env</code> (см. раздел Отладка).</li>
                </ul>
            </div>
            <div class="collapsible-header">
                <span>9.3.2. Laravel Herd (macOS и Windows)</span>
                <span class="arrow">▼</span>
            </div>
            <div class="collapsible-content">
                <p>Laravel Herd — нативная среда разработки, упрощающая управление PHP, Nginx/Caddy, DnsMasq.</p>
                <ul class="list-disc">
                    <li><strong>Распознавание IDE:</strong> Herd распознает Cursor.</li>
                    <li><strong>Команда `herd edit`:</strong> Может открыть текущий проект в Cursor.</li>
                    <li><strong>Интеграция с Dump UI:</strong> Клик по местоположению дампа в Herd Dump UI может открыть файл и строку в Cursor.</li>
                    <li><strong>Xdebug:</strong> Herd часто автоматически настраивает Xdebug, упрощая его использование.</li>
                </ul>
            </div>
            <p>Использование Sail или Herd рекомендуется, так как они стандартизируют и упрощают настройку окружения, что делает работу с Cursor более гладкой.</p>
        </section>

        <section id="security" class="content-section">
            <h2>10. Лучшие Практики Безопасности при Разработке с Использованием ИИ</h2>
            <p>Интеграция ИИ в рабочий процесс разработки вносит новые соображения безопасности. Хотя ИИ может повысить производительность, он также может генерировать небезопасный код, если его неправильно направлять и не проверять.</p>

            <h3>10.1. Обращение с Файлами `.env` и Конфиденциальными Данными</h3>
            <ul class="list-disc">
                <li><strong>Критическая важность <code>.cursorignore</code>:</strong> Повторите, что необходимо добавлять <code>.env*</code> и другие конфиденциальные файлы/папки (например, <code>storage/keys</code>, специфичные файлы конфигурации с секретами) в <code>.cursorignore</code>.</li>
                <li><strong>Риск:</strong> Модели ИИ потенциально могут обучаться на данных, переданных в промптах, или непреднамеренно раскрыть их, если они не были должным образом проигнорированы.</li>
                <li><strong>Усилия Cursor:</strong> Cursor прилагает усилия по блокированию доступа к игнорируемым файлам, но это скорее "наилучшие усилия" из-за непредсказуемого поведения LLM.</li>
            </ul>

            <h3>10.2. Безопасное Кодирование с Кодом, Сгенерированным ИИ</h3>
            <ul class="list-disc">
                <li><strong>Ответственность Разработчика:</strong> Подчеркнуть, что ИИ — это ассистент; разработчики в конечном счете несут ответственность за безопасность и качество кода.</li>
                <li><strong>Безопасный Промптинг:</strong> Инструктировать пользователей явно запрашивать безопасный код: "Сгенерируй действие контроллера Laravel для обработки загрузки файлов, обеспечив надлежащую валидацию типов файлов (jpg, png, pdf), ограничений по размеру (макс. 2МВ) и безопасные практики хранения, предотвращающие обход пути (path traversal). Используй Laravel Filesystem."</li>
                <li><strong>Обзор Кода, Сгенерированного ИИ:</strong>
                    <ul class="list-disc list-inside ml-4">
                        <li>Относиться к коду ИИ как к коду младшего разработчика; тщательно проверять.</li>
                        <li>Проверять на распространенные уязвимости: SQL-инъекции (даже с Eloquent сложные запросы могут быть рискованными), XSS (убедиться, что для вывода используется Blade <code>{{ }}</code>, а не <code>{!! !!}</code> без санации), массовое присваивание (проверять <code>$fillable</code>/<code>$guarded</code>), небезопасные прямые ссылки на объекты (IDOR – использовать политики/гейты), CSRF (убедиться, что используется <code>@csrf</code>).</li>
                        <li>Валидировать входы и выходы, даже если ИИ сгенерировал правила валидации.</li>
                    </ul>
                </li>
                <li><strong>Сканирование Зависимостей:</strong> Использовать инструменты, такие как Dependabot или Snyk, для проверки пакетов, предложенных ИИ.</li>
                <li><strong>Статический Анализ для Безопасности:</strong> Использовать PHPStan/Psalm для выявления ошибок, связанных с безопасностью, в коде ИИ.</li>
                <li><strong>OWASP Top Ten:</strong> Кратко упомянуть, как ИИ может непреднамеренно внести уязвимости из OWASP Top 10, и о необходимости осведомленности.</li>
            </ul>
            <p>Руководство должно продвигать подход "доверяй, но проверяй".</p>
        </section>

        <section id="tips-tricks" class="content-section">
            <h2>11. Советы, Трюки и Лучшие Практики</h2>
            <p>Эффективное использование Cursor — это сочетание знания его функций и умения правильно взаимодействовать с AI. Подход "человек-в-цикле" (human-in-the-loop) остается ключевым.</p>

            <h3>11.1. Общие советы по использованию Cursor</h3>
            <ul class="list-disc">
                <li><strong>Палитра команд (<code>Ctrl/⌘ + Shift + P</code>):</strong> Ваш главный инструмент для доступа ко всем функциям.</li>
                <li><strong>Настройте <code>settings.json</code>:</strong> Оптимизируйте рабочее пространство под свои предпочтения.</li>
                <li><strong>"YOLO mode" / Циклическое исправление ошибок (Agent):</strong> Мощный режим, когда Agent автоматически пытается исправлять ошибки. Используйте с осторожностью и частыми коммитами в Git.</li>
                <li><strong>Частые коммиты в Git:</strong> Особенно при работе с AI-агентом, чтобы легко отслеживать и отменять изменения.</li>
                <li><strong>Итеративный подход:</strong> Генерируйте код -> проверяйте diff -> просите AI исправить/доработать.</li>
                <li><strong>Обновляйте Cursor:</strong> Регулярно проверяйте и устанавливайте обновления Cursor IDE.</li>
            </ul>

            <h3>11.2. Советы по работе с Laravel в Cursor</h3>
            <ul class="list-disc">
                <li><strong>Промптинг:</strong> Будьте конкретны (версии Laravel, пакеты). Используйте <code>@CursorRules</code>. Разбивайте большие задачи.</li>
                <li><strong>Контекст:</strong> Активно используйте <code>@Files</code>, <code>@Folders</code>, <code>@Docs</code>. Для Laravel 11/12 учитывайте изменения.</li>
                <li><strong>Рабочие процессы:</strong> Комбинируйте Agent (для каркаса), Chat (для отладки/объяснений) и Cmd+K (для целевой генерации/редактирования).</li>
            </ul>

            <h3>11.3. Полезные сочетания клавиш (помимо основных AI)</h3>
            <div class="overflow-x-auto">
                <table>
                    <thead>
                    <tr>
                        <th>Действие</th>
                        <th>Сочетание в Cursor (macOS / Windows)</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr><td>Палитра команд</td><td><code>⌘ + Shift + P</code> / <code>Ctrl + Shift + P</code></td></tr>
                    <tr><td>Быстрое исправление / Контекстные действия</td><td><code>⌘ + .</code> / <code>Ctrl + .</code></td></tr>
                    <tr><td>Перейти к файлу</td><td><code>⌘ + P</code> / <code>Ctrl + P</code></td></tr>
                    <tr><td>Перейти к символу в рабочей области</td><td><code>⌘ + T</code> / <code>Ctrl + T</code></td></tr>
                    <tr><td>Закомментировать/раскомментировать строку</td><td><code>⌘ + /</code> / <code>Ctrl + /</code></td></tr>
                    <tr><td>Форматировать документ</td><td><code>Shift + Option + F</code> / <code>Shift + Alt + F</code></td></tr>
                    <tr><td>Открыть терминал</td><td><code>Ctrl + \`</code> / <code>Ctrl + \`</code> </td></tr>
                    <tr><td>Переключить боковую панель</td><td><code>⌘ + B</code> / <code>Ctrl + B</code></td></tr>
                    </tbody>
                </table>
            </div>
            <p>Полный список стандартных сочетаний VS Code (которые работают и в Cursor) можно найти в его документации или через <code>File > Preferences > Keyboard Shortcuts</code>.</p>

            <h3>11.4. Организация проекта для эффективной работы с AI</h3>
            <p>Структурирование некоторой информации о проекте может помочь AI лучше его понимать:</p>
            <ul class="list-disc">
                <li><strong>Директория <code>docs/</code> в проекте:</strong> Содержит <code>architecture.md</code>, <code>conventions.md</code>, <code>api_documentation.md</code>. AI может быть проинструктирован использовать эти файлы через <code>@Files docs/architecture.md</code>.</li>
                <li><strong>Директория <code>prompts/</code> в проекте:</strong> Сохраняйте удачные и часто используемые промпты для типовых задач.</li>
            </ul>
        </section>

        <section id="useful-links" class="content-section">
            <h2>12. Полезные Ссылки</h2>
            <p>Этот раздел представляет собой тщательно подобранный список ресурсов, жизненно важных для разработчиков PHP/Laravel, использующих Cursor (актуально на 29 Мая 2025).</p>

            <h3>12.1. Официальная Документация</h3>
            <h4>Cursor IDE:</h4>
            <ul class="list-disc">
                <li>Основная Документация: <a href="https://docs.cursor.com" target="_blank" class="text-sky-600 hover:underline link-external">docs.cursor.com</a> (или <a href="https://cursordocs.com/en" target="_blank" class="text-sky-600 hover:underline link-external">cursordocs.com/en</a>)</li>
                <li>Журнал Изменений (Changelog): <a href="https://cursor.com/changelog" target="_blank" class="text-sky-600 hover:underline link-external">cursor.com/changelog</a></li>
                <li>Горячие Клавиши: <a href="https://docs.cursor.com/kbd" target="_blank" class="text-sky-600 hover:underline link-external">docs.cursor.com/kbd</a></li>
                <li>Обзор @-Символов: <a href="https://docs.cursor.com/context/@-symbols/overview" target="_blank" class="text-sky-600 hover:underline link-external">docs.cursor.com/context/@-symbols/overview</a></li>
                <li>Документация по Правилам (.cursor/rules): <a href="https://docs.cursor.com/context/rules" target="_blank" class="text-sky-600 hover:underline link-external">docs.cursor.com/context/rules</a></li>
                <li>Документация по МСР: <a href="https://docs.cursor.com/context/model-context-protocol" target="_blank" class="text-sky-600 hover:underline link-external">docs.cursor.com/context/model-context-protocol</a></li>
            </ul>
            <h4>PHP:</h4>
            <ul class="list-disc">
                <li>Официальное Руководство PHP: <a href="https://www.php.net/manual/ru/" target="_blank" class="text-sky-600 hover:underline link-external">www.php.net/manual/ru/</a> (или /en/) (Актуально для PHP 8.3, 8.4)</li>
                <li>РНР: Правильный Путь: <a href="https://phptherightway.com" target="_blank" class="text-sky-600 hover:underline link-external">phptherightway.com</a> (Обновляется сообществом)</li>
            </ul>
            <h4>Laravel:</h4>
            <ul class="list-disc">
                <li>Документация Laravel (v11, v12): <a href="https://laravel.com/docs" target="_blank" class="text-sky-600 hover:underline link-external">laravel.com/docs</a> (всегда проверяйте актуальную версию, к Маю 2025 v12 может быть основной)</li>
            </ul>

            <h3>12.2. Ключевые Инструменты и Стандарты</h3>
            <ul class="list-disc">
                <li>Composer: <a href="https://getcomposer.org/doc/" target="_blank" class="text-sky-600 hover:underline link-external">getcomposer.org/doc/</a></li>
                <li>Packagist: <a href="https://packagist.org" target="_blank" class="text-sky-600 hover:underline link-external">packagist.org</a></li>
                <li>Xdebug: <a href="https://xdebug.org/docs" target="_blank" class="text-sky-600 hover:underline link-external">xdebug.org/docs</a></li>
                <li>PHPStan: <a href="https://phpstan.org" target="_blank" class="text-sky-600 hover:underline link-external">phpstan.org</a> (и Larastan для Laravel)</li>
                <li>Psalm: <a href="https://psalm.dev/docs" target="_blank" class="text-sky-600 hover:underline link-external">psalm.dev/docs</a></li>
                <li>PestPHP: <a href="https://pestphp.com/docs" target="_blank" class="text-sky-600 hover:underline link-external">pestphp.com/docs</a></li>
                <li>PHP Standards Recommendations (PSR): <a href="https://www.php-fig.org/psr/" target="_blank" class="text-sky-600 hover:underline link-external">www.php-fig.org/psr/</a></li>
            </ul>

            <h3>12.3. Ключевые Расширения VS Code (для Cursor)</h3>
            <p>Ссылки на страницы расширений в VS Code Marketplace:</p>
            <ul class="list-disc">
                <li>PHP Intelephense: <a href="https://marketplace.visualstudio.com/items?itemName=bmewburn.vscode-intelephense-client" target="_blank" class="text-sky-600 hover:underline link-external">bmewburn.vscode-intelephense-client</a></li>
                <li>PHP Debug (Xdebug Team): <a href="https://marketplace.visualstudio.com/items?itemName=xdebug.php-debug" target="_blank" class="text-sky-600 hover:underline link-external">xdebug.php-debug</a></li>
                <li>Official Laravel Extension: <a href="https://marketplace.visualstudio.com/items?itemName=laravel.vscode-laravel" target="_blank" class="text-sky-600 hover:underline link-external">laravel.vscode-laravel</a></li>
                <li>Laravel Blade Snippets: <a href="https://marketplace.visualstudio.com/items?itemName=onecentlin.laravel-blade" target="_blank" class="text-sky-600 hover:underline link-external">onecentlin.laravel-blade</a></li>
                <li>PHP DocBlocker: <a href="https://marketplace.visualstudio.com/items?itemName=neilbrayfield.php-docblocker" target="_blank" class="text-sky-600 hover:underline link-external">neilbrayfield.php-docblocker</a></li>
                <li>Error Lens: <a href="https://marketplace.visualstudio.com/items?itemName=usernamehw.errorlens" target="_blank" class="text-sky-600 hover:underline link-external">usernamehw.errorlens</a></li>
                <li>GitLens: <a href="https://marketplace.visualstudio.com/items?itemName=eamodio.gitlens" target="_blank" class="text-sky-600 hover:underline link-external">eamodio.gitlens</a></li>
                <li>Laravel Pint (Official): <a href="https://marketplace.visualstudio.com/items?itemName=open-southeners.laravel-pint" target="_blank" class="text-sky-600 hover:underline link-external">open-southeners.laravel-pint</a></li>

            </ul>

            <h3>12.4. МСР-Серверы и Связанные Инструменты</h3>
            <ul class="list-disc">
                <li>Context7: <a href="https://context7.com/" target="_blank" class="text-sky-600 hover:underline link-external">context7.com</a>, GitHub <a href="https://github.com/upstash/context7-mcp" target="_blank" class="text-sky-600 hover:underline link-external">@upstash/context7-mcp</a></li>
                <li>jsonallen/laravel-mcp: <a href="https://github.com/jsonallen/laravel-mcp" target="_blank" class="text-sky-600 hover:underline link-external">GitHub</a></li>
                <li>php-mcp/laravel: <a href="https://github.com/php-mcp/laravel" target="_blank" class="text-sky-600 hover:underline link-external">GitHub</a></li>
                <li>usecroft/croft-laravel: <a href="https://github.com/usecroft/croft-laravel" target="_blank" class="text-sky-600 hover:underline link-external">GitHub</a>, <a href="https://packagist.org/packages/usecroft/croft-laravel" target="_blank" class="text-sky-600 hover:underline link-external">Packagist</a></li>
                <li>mem0.ai / OpenMemory MCP: <a href="https://github.com/mem0ai/mem0" target="_blank" class="text-sky-600 hover:underline link-external">GitHub</a>, Документация <a href="https://docs.mem0.ai/openmemory/overview" target="_blank" class="text-sky-600 hover:underline link-external">docs.mem0.ai</a></li>
                <li>Cursor Directory (Правила и МСР): <a href="https://cursor.directory/" target="_blank" class="text-sky-600 hover:underline link-external">cursor.directory</a></li>
            </ul>

            <h3>12.5. Форумы Сообщества и Обсуждения</h3>
            <ul class="list-disc">
                <li>Cursor Forum: <a href="https://forum.cursor.com" target="_blank" class="text-sky-600 hover:underline link-external">forum.cursor.com</a></li>
                <li>Reddit: <a href="https://www.reddit.com/r/laravel/" target="_blank" class="text-sky-600 hover:underline link-external">r/laravel</a>, <a href="https://www.reddit.com/r/PHP/" target="_blank" class="text-sky-600 hover:underline link-external">r/PHP</a>, <a href="https://www.reddit.com/r/cursor/" target="_blank" class="text-sky-600 hover:underline link-external">r/cursor</a></li>
                <li>Stack Overflow: Теги <a href="https://stackoverflow.com/questions/tagged/laravel" target="_blank" class="text-sky-600 hover:underline link-external">laravel</a>, <a href="https://stackoverflow.com/questions/tagged/php" target="_blank" class="text-sky-600 hover:underline link-external">php</a>, <a href="https://stackoverflow.com/questions/tagged/cursor-ide" target="_blank" class="text-sky-600 hover:underline link-external">cursor-ide</a></li>
                <li>Laravel News: <a href="https://laravel-news.com/" target="_blank" class="text-sky-600 hover:underline link-external">laravel-news.com</a> (для новостей и статей)</li>
            </ul>

            <h3>12.6. Обучающие Платформы и Руководства (PHP/Laravel/Cursor)</h3>
            <ul class="list-disc">
                <li>Laracasts: <a href="https://laracasts.com" target="_blank" class="text-sky-600 hover:underline link-external">laracasts.com</a></li>
                <li>Laravel Daily: <a href="https://www.youtube.com/laraveldaily" target="_blank" class="text-sky-600 hover:underline link-external">YouTube</a>, <a href="https://laraveldaily.com/courses" target="_blank" class="text-sky-600 hover:underline link-external">Курсы</a> (включая курсы по Cursor)</li>
                <li>Kirschbaum Development Blog (статьи по AI и Laravel): <a href="https://kirschbaumdevelopment.com/insights" target="_blank" class="text-sky-600 hover:underline link-external">kirschbaumdevelopment.com/insights</a></li>
                <li>Spatie Blog: <a href="https://spatie.be/blog" target="_blank" class="text-sky-600 hover:underline link-external">spatie.be/blog</a> (много полезных статей по PHP и Laravel)</li>
            </ul>

            <h3>12.7. Ключевые Репозитории GitHub (Инструменты и Пакеты)</h3>
            <ul class="list-disc">
                <li>Spatie PHP/Laravel Packages: <a href="https://spatie.be/opensource" target="_blank" class="text-sky-600 hover:underline link-external">spatie.be/opensource</a></li>
                <li>barryvdh/laravel-ide-helper: <a href="https://github.com/barryvdh/laravel-ide-helper" target="_blank" class="text-sky-600 hover:underline link-external">GitHub</a></li>
                <li>Laravel Framework: <a href="https://github.com/laravel/framework" target="_blank" class="text-sky-600 hover:underline link-external">GitHub</a></li>
            </ul>
            <h3>12.8. Ресурсы по Безопасности</h3>
            <ul class="list-disc">
                <li>OWASP Top Ten: <a href="https://owasp.org/www-project-top-ten/" target="_blank" class="text-sky-600 hover:underline link-external">owasp.org/www-project-top-ten/</a></li>
                <li>PHP The Right Way - Security: <a href="https://phptherightway.com/#security" target="_blank" class="text-sky-600 hover:underline link-external">phptherightway.com/#security</a></li>
                <li>Laravel Documentation - Security: <a href="https://laravel.com/docs/11.x/security" target="_blank" class="text-sky-600 hover:underline link-external">laravel.com/docs/11.x/security</a> (замените 11.x на актуальную версию)</li>
            </ul>
        </section>

        <section id="conclusion" class="content-section">
            <h2>13. Заключение: Принимая Будущее AI-ассистированной Разработки на Laravel</h2>
            <p>Инструменты, подобные Cursor, представляют собой не просто постепенные улучшения, а потенциальный сдвиг парадигмы в том, как разрабатывается программное обеспечение, включая приложения на Laravel, движение к более тесной совместной модели человек-ИИ. Способность генерировать большие объемы кода, проводить рефакторинг, помогать в отладке и понимать целые кодовые базы с помощью LLM меняет характер повседневных задач разработчика.</p>
            <p>Cursor IDE предлагает мощный набор инструментов для разработчиков PHP и Laravel, сочетая знакомую среду VS Code с передовыми возможностями искусственного интеллекта. Его способность понимать контекст кодовой базы, генерировать код, помогать в рефакторинге и отладке может значительно повысить продуктивность и качество разработки.</p>
            <p><strong>Ключ к успешному использованию Cursor лежит в:</strong></p>
            <ol class="list-decimal">
                <li><strong>Тщательной настройке среды:</strong> Установка необходимых РНР-расширений, настройка интерпретатора и Xdebug, а также использование таких инструментов, как Laravel Sail или Herd.</li>
                <li><strong>Эффективном использовании функций ИИ:</strong> Освоение автодополнения Tab, Cmd+K, Чата и режима Агента, а также мастерское применение @-символов для предоставления точного контекста.</li>
                <li><strong>Грамотной конфигурации проекта:</strong> Использование <code>.cursor/rules</code> для внедрения специфичных для Laravel лучших практик и <code>.cursorignore</code> для защиты конфиденциальных данных и оптимизации производительности.</li>
                <li><strong>Интеграции с экосистемой Laravel:</strong> Эффективное применение Composer, Artisan и инструментов управления окружением через терминал Cursor, усиленное возможностями ИИ.</li>
                <li><strong>Расширении возможностей через МСР-серверы:</strong> Использование существующих или даже создание пользовательских МСР-серверов для взаимодействия ИИ с внешними системами, данными и для управления "памятью" ИИ.</li>
            </ol>
            <p>Cursor — это не волшебная палочка, а мощный помощник, требующий умелого управления. При правильной конфигурации и осмысленном применении в сочетании с экосистемой PHP/Laravel он способен стать катализатором продуктивности и инноваций.</p>
            <p>Поскольку инструменты ИИ продолжают стремительно развиваться, разработчикам важно сохранять любознательность, экспериментировать и постоянно учиться. Принятие таких инструментов, как Cursor, это не просто изучение еще одной IDE, а шаг в новую эру разработки программного обеспечения, где сотрудничество человека и ИИ открывает новые горизонты эффективности и креативности.</p>
        </section>
    </main>
</div>

<script>
    const navLinks = document.querySelectorAll('.nav-link');
    const contentSections = document.querySelectorAll('.content-section');
    const collapsibleHeaders = document.querySelectorAll('.collapsible-header');

    function showSection(targetId) {
        contentSections.forEach(section => {
            section.classList.remove('active');
        });
        const targetElement = document.getElementById(targetId);
        if (targetElement) {
            targetElement.classList.add('active');
        }

        navLinks.forEach(link => {
            link.classList.remove('active');
            if (link.dataset.target === targetId) {
                link.classList.add('active');
            }
        });
        const mainContentArea = document.querySelector('main');
        if (mainContentArea) {
            mainContentArea.scrollTop = 0;
        }
    }

    navLinks.forEach(link => {
        link.addEventListener('click', (e) => {
            e.preventDefault();
            const targetId = e.target.closest('.nav-link').dataset.target;
            showSection(targetId);
            // Update URL hash without causing a page jump if already on the section
            if (window.location.hash !== `#${targetId}`) {
                history.pushState(null, null, `#${targetId}`);
            }
        });
    });

    collapsibleHeaders.forEach(header => {
        header.addEventListener('click', () => {
            const content = header.nextElementSibling;
            const arrow = header.querySelector('.arrow');

            if (content.classList.contains('open')) {
                content.style.maxHeight = null; // Reset maxHeight for CSS transition
                content.classList.remove('open');
                if (arrow) arrow.style.transform = 'rotate(0deg)';
            } else {
                content.classList.add('open');
                content.style.maxHeight = content.scrollHeight + "px"; // Set maxHeight for CSS transition
                if (arrow) arrow.style.transform = 'rotate(180deg)';
            }
        });
        // Ensure collapsible content has appropriate CSS for transition
        const content = header.nextElementSibling;
        if (content && content.classList.contains('collapsible-content')) {
            content.style.overflow = 'hidden';
            content.style.transition = 'max-height 0.3s ease-out';
            if (!content.classList.contains('open')) {
                content.style.maxHeight = '0';
            }
        }
    });


    function setupCopyButtonBehavior(buttonEl, codeContentEl) {
        buttonEl.addEventListener('click', () => {
            const textToCopy = codeContentEl.innerText;
            const textArea = document.createElement('textarea');
            textArea.value = textToCopy;
            document.body.appendChild(textArea);
            textArea.select();
            try {
                document.execCommand('copy');
                buttonEl.innerText = 'Скопировано!';
                setTimeout(() => {
                    buttonEl.innerText = 'Копировать';
                }, 2000);
            } catch (err) {
                console.error('Ошибка копирования:', err);
                buttonEl.innerText = 'Ошибка';
                setTimeout(() => {
                    buttonEl.innerText = 'Копировать';
                }, 2000);
            }
            document.body.removeChild(textArea);
        });
    }

    document.querySelectorAll('.copy-btn').forEach(button => {
        const preElement = button.closest('pre');
        if (preElement) {
            const codeElement = preElement.querySelector('code');
            if (codeElement) {
                setupCopyButtonBehavior(button, codeElement);
            }
        }
    });

    function handleHashChange() {
        const hash = window.location.hash.substring(1);
        if (hash) {
            const targetSection = document.getElementById(hash);
            if (targetSection && targetSection.classList.contains('content-section')) {
                showSection(hash);
                // Open parent collapsible if target is inside one
                let parentCollapsibleContent = targetSection.closest('.collapsible-content');
                while(parentCollapsibleContent) {
                    if (!parentCollapsibleContent.classList.contains('open')) {
                        const header = parentCollapsibleContent.previousElementSibling;
                        if (header && header.classList.contains('collapsible-header')) {
                            header.click(); // Simulate click to open
                        }
                    }
                    parentCollapsibleContent = parentCollapsibleContent.parentElement.closest('.collapsible-content');
                }
                return;
            }
        }
        showSection('introduction');
    }

    window.addEventListener('hashchange', handleHashChange);
    window.addEventListener('load', handleHashChange);


    // Gemini API Integration
    const apiKey = ""; // API Key will be injected by the environment

    async function callGeminiApi(promptText, outputElement, loaderElement, errorElement, buttonElement, outputContainer) {
        loaderElement.style.display = 'block';
        errorElement.style.display = 'none';
        outputContainer.style.display = 'none';
        buttonElement.disabled = true;

        try {
            let chatHistory = [{ role: "user", parts: [{ text: promptText }] }];
            const payload = { contents: chatHistory };
            const currentApiKey = typeof apiKey !== 'undefined' && apiKey !== "" ? apiKey : (typeof __GEMINI_API_KEY__ !== 'undefined' ? __GEMINI_API_KEY__ : "");

            if (!currentApiKey && !window.location.href.includes('localhost')) {
                throw new Error("API Key is not available. This feature requires a valid API key to function.");
            }

            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${currentApiKey}`;

            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });

            if (!response.ok) {
                const errorData = await response.json();
                let errorMessage = `API request failed with status ${response.status}`;
                if (errorData && errorData.error && errorData.error.message) {
                    errorMessage += `: ${errorData.error.message}`;
                    if (errorData.error.message.toLowerCase().includes("api key not valid")) {
                        errorMessage = "Ключ API недействителен или отсутствует. Проверьте конфигурацию ключа. Эта функция не будет работать без действительного ключа.";
                    }
                } else if (response.status === 403) {
                    errorMessage = "Доступ запрещен (403). Возможно, API ключ не имеет необходимых разрешений или сервис недоступен.";
                }
                throw new Error(errorMessage);
            }

            const result = await response.json();

            if (result.candidates && result.candidates.length > 0 &&
                result.candidates[0].content && result.candidates[0].content.parts &&
                result.candidates[0].content.parts.length > 0) {
                const text = result.candidates[0].content.parts[0].text;
                outputElement.textContent = text; // Use textContent for pre > code
                outputContainer.style.display = 'block';
            } else if (result.promptFeedback && result.promptFeedback.blockReason) {
                throw new Error(`Запрос заблокирован по причине: ${result.promptFeedback.blockReason}. Детали: ${JSON.stringify(result.promptFeedback.safetyRatings)}`);
            } else {
                throw new Error("Ответ API не содержит ожидаемых данных или был пустым.");
            }

        } catch (error) {
            console.error("Ошибка при вызове Gemini API:", error);
            errorElement.textContent = `Произошла ошибка: ${error.message}. Пожалуйста, попробуйте еще раз или проверьте консоль для деталей.`;
            errorElement.style.display = 'block';
        } finally {
            loaderElement.style.display = 'none';
            buttonElement.disabled = false;
        }
    }

    const generateRuleButton = document.getElementById('generateRuleButton');
    const ruleInput = document.getElementById('ruleInput');
    const ruleOutputMdc = document.getElementById('ruleOutputMdc');
    const ruleLoader = document.getElementById('ruleLoader');
    const ruleError = document.getElementById('ruleError');
    const ruleOutputContainer = document.getElementById('ruleOutputContainer');

    if (generateRuleButton) {
        generateRuleButton.addEventListener('click', async () => {
            const userInput = ruleInput.value.trim();
            if (!userInput) {
                ruleError.textContent = "Пожалуйста, опишите правило.";
                ruleError.style.display = 'block';
                return;
            }
            // Updated prompt based on PDF recommendations for more detailed rule generation
            const geminiPrompt = `Сгенерируй содержимое файла Cursor Rule (.mdc) для следующего правила, предназначенного для PHP/Laravel проекта (версии Laravel 11+, PHP 8.2+): "${userInput}".
Правило должно быть в формате MDC, включая YAML frontmatter и тело правила в Markdown.

YAML frontmatter должен содержать:
- \`description\`: Краткое, но информативное описание назначения правила, особенно если оно предназначено для типа 'Agent Requested'.
- \`globs\`: Массив паттернов файлов (например, ["app/Http/Controllers/**/*.php", "*.blade.php"]), если правило должно автоматически применяться к определенным файлам (тип 'Auto Attached'). Оставь пустым или опусти, если не применимо.
- \`alwaysApply\`: \`true\` или \`false\`. Установи \`true\` для правил типа 'Always'.

Тело правила в Markdown должно:
- Быть конкретным и действенным.
- Использовать четкие формулировки.
- Включать короткие примеры кода (в \`php ... \` блоках), если это помогает прояснить правило.
- Ссылаться на релевантные файлы проекта (например, @app/Services/MyService.php), если это необходимо.
- Отражать лучшие практики и соглашения Laravel (например, PSR-12, использование Eloquent ORM, Form Requests, сервисных классов, API Resources).
- Быть кратким, но полным (стараться уместиться в разумные пределы, например, до 500 строк).

Пример структуры:
---
description: "Контроллеры должны быть тонкими и использовать Form Requests."
globs: ["app/Http/Controllers/**/*.php"]
alwaysApply: false
---
# Руководство по контроллерам
- Контроллеры должны делегировать бизнес-логику сервисным классам.
- Для валидации входящих данных всегда используйте Form Requests.
  Пример: \`public function store(StoreProductRequest \$request)\`
- Избегайте прямой работы с \`\$request->all()\` без валидации.

Убедись, что YAML frontmatter корректен. Ответ должен содержать только код правила в формате MDC, без дополнительных объяснений или введений.`;
            await callGeminiApi(geminiPrompt, ruleOutputMdc, ruleLoader, ruleError, generateRuleButton, ruleOutputContainer);
        });
    }

    const generatePromptButton = document.getElementById('generatePromptButton');
    const promptTaskInput = document.getElementById('promptTaskInput');
    const promptOutputText = document.getElementById('promptOutputText');
    const promptLoader = document.getElementById('promptLoader');
    const promptError = document.getElementById('promptError');
    const promptOutputContainer = document.getElementById('promptOutputContainer');

    if (generatePromptButton) {
        generatePromptButton.addEventListener('click', async () => {
            const userInput = promptTaskInput.value.trim();
            if (!userInput) {
                promptError.textContent = "Пожалуйста, опишите задачу.";
                promptError.style.display = 'block';
                return;
            }
            // Updated prompt based on PDF recommendations for more effective prompt generation
            const geminiPrompt = `Помоги мне создать эффективный промпт для AI-ассистента в Cursor IDE (например, Gemini, GPT-4, Claude) для выполнения следующей задачи в PHP/Laravel проекте (Laravel 11+, PHP 8.2+): "${userInput}".

Промпт должен быть:
1.  **Конкретным и ясным**: Четко определить цель и ожидаемый результат.
2.  **Контекстно-богатым**: Указать на необходимость предоставления релевантного контекста AI (например, через \`@Files path/to/file.php\`, \`@Folders app/Services\`, \`@CursorRules:my-rule-name\`). Если задача затрагивает определенные пакеты (Spatie, Livewire, Filament), упомянуть их.
3.  **Ориентированным на лучшие практики Laravel**: Подчеркнуть важность следования конвенциям Laravel (PSR-12, структура проекта, Eloquent, Form Requests, сервисы, API Resources, и т.д.).
4.  **Итеративным и планирующим**: Предложить AI сначала составить план, если задача сложная, и разбить ее на подзадачи. Поощрять AI задавать уточняющие вопросы.
5.  **Требовательным к качеству кода**: Если задача включает генерацию кода, указать на важность PHPDoc, строгой типизации, чистоты, читаемости, производительности и написания тестов (например, PestPHP).
6.  **Специфичным для версии**: Упомянуть версии Laravel и PHP, если это критично.
7.  **Сформулирован как прямое обращение к AI в Cursor.**

Пример структуры промпта, который нужно адаптировать:
"Привет, Cursor! Пожалуйста, помоги мне с [основная задача, например, созданием CRUD API для модели Product].

**Детали задачи:**
- Модель: \`Product\` (@app/Models/Product.php)
- Используемые версии: Laravel 11, PHP 8.2.
- Бизнес-логика должна быть в \`ProductService\` (@app/Services/ProductService.php).
- Валидация через Form Requests: \`StoreProductRequest\` и \`UpdateProductRequest\` (@app/Http/Requests/).
- Ответы API должны быть отформатированы с помощью \`ProductResource\` (@app/Http/Resources/ProductResource.php).
- Метод \`index\` должен поддерживать пагинацию и фильтрацию по полю 'category_id'.
- Необходимо сгенерировать PestPHP feature тесты для всех эндпоинтов.

**Контекст и Правила:**
- Используй правила: @controller-guidelines, @eloquent-model-guidelines, @pest-testing-guidelines.
- Обрати внимание на существующий код в указанных файлах.

**Требования к коду:**
- Строгая типизация, подробные PHPDoc.
- Чистый, читаемый и производительный код.
- Покрытие тестами основных сценариев и пограничных случаев.

Если что-то неясно или задача кажется слишком объемной, пожалуйста, задай уточняющие вопросы или предложи сначала план выполнения.
Ожидаемый результат: Полностью рабочий \`ProductController\` с CRUD методами, соответствующий \`ProductService\`, Form Requests, API Resource и набор PestPHP тестов."

Сгенерируй только текст самого промпта, который я смогу скопировать и использовать в Cursor, без дополнительных объяснений или введений с твоей стороны.`;
            await callGeminiApi(geminiPrompt, promptOutputText, promptLoader, promptError, generatePromptButton, promptOutputContainer);
        });
    }
</script>
</body>
</html>
